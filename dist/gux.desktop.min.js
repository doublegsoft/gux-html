function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,e){var n,i,r,a,o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(o)return r=!(i=!0),{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){r=!0,n=t},f:function(){try{i||null==o.return||o.return()}finally{if(r)throw n}}};if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return o&&(t=o),a=0,{s:e=function(){},n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var n;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(n="Object"===(n={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function _regeneratorRuntime(){_regeneratorRuntime=function(){return o};var l,o={},t=Object.prototype,d=t.hasOwnProperty,c=Object.defineProperty||function(t,e,n){t[e]=n.value},e="function"==typeof Symbol?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",r=e.toStringTag||"@@toStringTag";function a(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(l){a=function(t,e,n){return t[e]=n}}function s(t,e,n,i){var r,a,o,s,e=e&&e.prototype instanceof y?e:y,e=Object.create(e.prototype),i=new C(i||[]);return c(e,"_invoke",{value:(r=t,a=n,o=i,s=p,function(t,e){if(s===f)throw Error("Generator is already running");if(s===m){if("throw"===t)throw e;return{value:l,done:!0}}for(o.method=t,o.arg=e;;){var n=o.delegate;if(n){n=function t(e,n){var i=n.method,r=e.iterator[i];if(r===l)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=l,t(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;i=u(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;r=i.arg;return r?r.done?(n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,g):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}(n,o);if(n){if(n===g)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(s===p)throw s=m,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s=f;n=u(r,a,o);if("normal"===n.type){if(s=o.done?m:h,n.arg===g)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(s=m,o.method="throw",o.arg=n.arg)}})}),e}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}o.wrap=s;var p="suspendedStart",h="suspendedYield",f="executing",m="completed",g={};function y(){}function v(){}function b(){}var e={},w=(a(e,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(A([]))),x=(w&&w!==t&&d.call(w,i)&&(e=w),b.prototype=y.prototype=Object.create(e));function E(t){["next","throw","return"].forEach(function(e){a(t,e,function(t){return this._invoke(e,t)})})}function O(o,s){var e;c(this,"_invoke",{value:function(n,i){function t(){return new s(function(t,e){!function e(t,n,i,r){var a,t=u(o[t],o,n);if("throw"!==t.type)return(n=(a=t.arg).value)&&"object"==_typeof(n)&&d.call(n,"__await")?s.resolve(n.__await).then(function(t){e("next",t,i,r)},function(t){e("throw",t,i,r)}):s.resolve(n).then(function(t){a.value=t,i(a)},function(t){return e("throw",t,i,r)});r(t.arg)}(n,i,t,e)})}return e=e?e.then(t,t):t()}})}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function A(e){if(e||""===e){var n,t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return n=-1,(t=function t(){for(;++n<e.length;)if(d.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=l,t.done=!0,t}).next=t}throw new TypeError(_typeof(e)+" is not iterable")}return c(x,"constructor",{value:v.prototype=b,configurable:!0}),c(b,"constructor",{value:v,configurable:!0}),v.displayName=a(b,r,"GeneratorFunction"),o.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,a(t,r,"GeneratorFunction")),t.prototype=Object.create(x),t},o.awrap=function(t){return{__await:t}},E(O.prototype),a(O.prototype,n,function(){return this}),o.AsyncIterator=O,o.async=function(t,e,n,i,r){void 0===r&&(r=Promise);var a=new O(s(t,e,n,i),r);return o.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},E(x),a(x,r,"Generator"),a(x,i,function(){return this}),a(x,"toString",function(){return"[object Generator]"}),o.keys=function(t){var e,n=Object(t),i=[];for(e in n)i.push(e);return i.reverse(),function t(){for(;i.length;){var e=i.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},o.values=A,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&d.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var i=this;function t(t,e){return a.type="throw",a.arg=n,i.next=t,e&&(i.method="next",i.arg=l),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e],a=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var o=d.call(r,"catchLoc"),s=d.call(r,"finallyLoc");if(o&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(o){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&d.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var a=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc?null:r)?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n,i,r=this.tryEntries[e];if(r.tryLoc===t)return"throw"===(n=r.completion).type&&(i=n.arg,_(r)),i}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=l),g}},o}function asyncGeneratorStep(t,e,n,i,r,a,o){try{var s=t[a](o),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(s){return function(){var t=this,o=arguments;return new Promise(function(e,n){var i=s.apply(t,o);function r(t){asyncGeneratorStep(i,e,n,r,a,"next",t)}function a(t){asyncGeneratorStep(i,e,n,r,a,"throw",t)}r(void 0)})}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}ajax={},ajax.view=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var n,i,r,a,o,s,l,d;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(d=e.url,n=!1,n=void 0===e.empty||e.empty,e.page,i=e.title||"",l=e.containerId,r=e.params||{},a=e.success,o=null,"string"==typeof l?null==(o=document.getElementById(l.trim()))&&(o=document.querySelector(l.trim())):o=l,"undefined"==typeof data&&(data={}),window.parameters)for(s in data)window.parameters[s]=data[s];return window._current_view&&(window._current_view.destroy&&window._current_view.destroy(),delete window._current_view),t.next=15,xhr.get({url:d});case 15:l=t.sent,d=null,o&&(d=dom.append(o,l,n),!0===e.headless)&&(dom.find(".page-header",o).remove(),d.container.children[0].classList.remove("page")),d&&d.id&&window[d.id]&&window[d.id].show&&!a&&(window[d.id].show(r),window._current_view=window[d.id]),a&&a(i,d,r);case 20:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),ajax.sidebar=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var n,i,r,a,o,s,l,d,c,u,p,h;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(c=(c=dom.find(e.containerId))||document.body,n=e.success||function(t,e){},i=dom.find("[widget-id=widgetSidebar]"),r=e.allowClose||!1,null!=i&&i.remove(),i=dom.element('\n    <div widget-id="widgetSidebar" style="position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: rgba(0,0,0,0.15); z-index: 9999;">\n      <div class="gx-sidebar fade show">\n        <div class="modal-dialog" role="document">\n          <div class="modal-content">\n            <div class="page-header pl-3">\n              <h5 class="modal-title"></h5>\n              <button type="button" class="close text-danger position-relative" style="display:none;">\n                <i class="fas fa-times"></i>\n              </button>\n            </div>\n            <div class="modal-body" style="overflow-y: auto;"></div>\n            <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: 48px; border-top: 1px solid lightgrey; background: white; z-index: 9999; display: none;">\n              <div widget-id="widgetSidebarActions" class="mh-10 mt-2" style="float: right;"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  '),e.actions&&0<e.actions.length){dom.find(".modal-body",i).style.marginBottom="48px",(a=dom.find("[widget-id=widgetSidebarActions]",i)).parentElement.style.display="",o=_createForOfIteratorHelper(e.actions);try{for(o.s();!(s=o.n()).done;)l=s.value,(d=dom.create("button")).innerHTML=l.title,d.setAttribute("class",l.classes),d.style.marginRight="12px",dom.bind(d,"click",l.onClick),a.appendChild(d)}catch(t){o.e(t)}finally{o.f()}}if(i.addEventListener("click",function(t){"widgetSidebar"===t.target.getAttribute("widget-id")&&(i.children[0].classList.remove("in"),i.children[0].classList.add("out"),setTimeout(function(){i.remove()},300))}),c.appendChild(i),e.url&&0==e.url.indexOf(":")&&(e.page=e.url.substring(1),e.url=null),c="",e.url)return t.next=15,xhr.get({url:e.url});t.next=18;break;case 15:c=t.sent,t.next=19;break;case 18:e.html&&(c=e.html);case 19:dom.find(".modal-title",i).innerHTML=e.title||"",dom.find(".modal-body",i).innerHTML="",r||e.close||dom.find("button.close",i).classList.add("hidden"),!0===r&&(u=dom.find("button.close",i),p=dom.find(".card-header",i),h=u.getBoundingClientRect(),p=p.getBoundingClientRect(),p=(p.height-h.height)/2,u.style.top=p+"px",u.style.right=p+"px"),dom.find("button.close",i).addEventListener("click",function(){i.children[0].classList.add("out"),i.remove(),e.close&&e.close()}),h=dom.append(dom.find(".modal-body",i),c),n&&n(e.title||"",h),setTimeout(function(){i.children[0].classList.remove("out"),i.children[0].classList.add("in")},300);case 27:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),dialog={confirm:function(t,n){layer.confirm(t,{title:"确认",btn:["确定","取消"]},function(t,e){e=dom.formdata(e[0]);layer.close(t),n(e)},function(){})},html:function(n){layer.open({type:0,closeBtn:1,offset:"150px",shade:.5,area:[n.width||"50%",""],shadeClose:!0,title:n.title||"&nbsp;",content:n.html,btn:["确定","关闭"],success:function(t,e){n.load&&n.load(t,e)},yes:function(t,e){e=dom.find("div.layui-layer-content",e[0]);1==e.children.length?n.success(e.children[0]):n.success(e.children),layer.close(t)},btn1:function(){}})}},"undefined"==typeof dnd&&(dnd={}),dnd.setDraggable=function(t,o,s){var l="string"==typeof t?document.querySelector(t):t;l.setAttribute("draggable","true"),l.ondragstart=function(t){var e,n,i=l.getAttribute("widget-drag-image"),r=event.clientX,a=event.clientY;for(e in o)t.dataTransfer.setData(e,o[e]);i&&""!=i&&((n=new Image).src=i,t.dataTransfer.setDragImage(n,r,a));i=event.target;s&&s(r,a,i)}},dnd.clearDraggable=function(t){t="string"==typeof t?document.querySelector(t):t;t.setAttribute("draggable","false"),t.removeEventListener("dragstart",function(){})},dnd.setDroppable=function(t,o){var s="string"==typeof t?document.querySelector(t):t;s.ondragover=function(t){t.preventDefault()},s.ondrop=function(t){t.preventDefault(),t.stopPropagation();var e=s.getBoundingClientRect(),n=t.clientX-e.left,e=t.clientY-e.top;if(o){for(var i={},r=0;r<t.dataTransfer.items.length;r++){var a=t.dataTransfer.items[r].type;i[a]=t.dataTransfer.getData(a)}o(parseInt(n),e,i)}}},dom={create:function(t){for(var e=Array.prototype.slice.call(arguments,1),n=document.createElement(t),i=0;i<e.length;i++)n.classList.add(e[i]);return n},append:function(t,e,n){var i=dom.create("div");i.style.height="100%",i.style.width="100%",n=n||!1;e=document.createRange().createContextualFragment(e),!1!==n&&(t.innerHTML=""),t.appendChild(i),i.appendChild(e),n=dom.find("[id^=page]",i);return n?i.setAttribute("page-id",n.id):i.setAttribute("page-id","page.not.in.database"),{id:n?n.id:"",container:i}},find:function(t,e){return e=e||document,"string"!=typeof t?t:0==(e=e.querySelectorAll(t)).length?null:1==e.length?e[0]:e},ancestor:function(t,e,n){var i=null;if(n=n||"",null==(i="string"==typeof t?document.querySelector(t):t))return null;e=e.toUpperCase();var r=i;if(""==n)for(;null!=r&&r.tagName!=e;)r=r.parentElement;else for(;null!=r&&(r.tagName!=e||!r.classList.contains(n));)r=r.parentElement;return r},element:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstElementChild},bind:function(t,e,n){var i=null;null!=(i="string"==typeof t?document.querySelector(t):t)&&i&&i.addEventListener(e,n)},model:function(t,e){var n,i=null,i="string"==typeof t?document.querySelector(t):t;if(void 0===e)return n={},Array.prototype.slice.call(i.attributes).forEach(function(e){if(0==e.name.indexOf("data-model-"))if(0==e.value.indexOf("{"))try{n[utils.nameVar(e.name.slice("data-model-".length))]=JSON.parse(e.value)}catch(t){n[utils.nameVar(e.name.slice("data-model-".length))]=e.value}else n[utils.nameVar(e.name.slice("data-model-".length))]=e.value}),n;var r=Array.prototype.slice.call(arguments,2);if(0==r.length)for(var a in e)0!=a.indexOf("||")&&0!=a.indexOf("//")&&0!=a.indexOf(">>")&&("object"===_typeof(e[a])?i.setAttribute(utils.nameAttr(a),JSON.stringify(e[a])):i.setAttribute(utils.nameAttr(a),e[a]));else for(var o=0;o<r.length;o++){var s=r[o];0!=s.indexOf("||")&&0!=s.indexOf("//")&&0!=s.indexOf(">>")&&("object"===_typeof(e[s])?i.setAttribute(utils.nameAttr(s),JSON.stringify(e[s])):i.setAttribute(utils.nameAttr(s),e[s]))}},collect:function(t,e){for(var n=[],i=document.querySelectorAll(t),r=0;r<i.length;r++){var a={};if(Array.isArray(e))for(var o=0;o<e.length;o++)a[e[o]]=i[r].getAttribute(utils.nameAttr(e[o]));else a[e]=i.getAttribute(utils.nameAttr(e[j]));n.push(a)}return n},propagate:function(t,e,n,i){var r=i(e);if(Array.isArray(n))for(var a=0;a<n.length;a++)r.setAttribute(utils.nameAttr(n[a]),e[n[a]]);else r.setAttribute(utils.nameAttr(n),e[n]);t.appendChild(r)},toggle:function(t,f){for(var e=document.querySelectorAll(t),n=0;n<e.length;n++)e[n].addEventListener("click",function(){for(var t=this.getAttribute("data-toggle").split(">>"),e=t[0].split("+"),n=t[1].split("+"),i=!1,r=0;r<e.length;r++){var a=e[r].trim();i=0==a.indexOf(".")?this.classList.contains(a.substring(1)):null!=this.querySelector(a)}if(i){for(var o=0;o<n.length;o++){var s=n[o].trim();0===s.indexOf(".")?this.classList.add(s.substring(1)):this.querySelector(s.substring(0,s.indexOf("."))).classList.add(s.substring(s.indexOf(".")+1))}for(var l=0;l<e.length;l++){var d=e[l].trim();0==d.indexOf(".")?this.classList.remove(d.substring(1)):this.querySelector(d).classList.remove(d.substring(d.indexOf(".")+1))}}else{for(var c=0;c<e.length;c++){var u=e[c].trim();0==u.indexOf(".")?this.classList.add(u.substring(1)):this.querySelector(u.substring(0,u.indexOf("."))).classList.add(u.substring(u.indexOf(".")+1))}for(var p=0;p<n.length;p++){var h=n[p].trim();0==h.indexOf(".")?this.classList.remove(h.substring(1)):this.querySelector(h).classList.remove(h.substring(h.indexOf(".")+1))}f&&resovle(this)}})}},dom.switch=function(t,r){for(var a=dom.find(t),o=a.getAttribute("data-switch").split("+"),e=a.querySelectorAll(o[0]),n=0;n<e.length;n++)!function(){var i=e[n];i.onclick=function(t){for(var e=a.querySelectorAll(o[0]),n=0;n<e.length;n++)e[n].classList.remove(o[1].substring(1));i.classList.add(o[1].substring(1)),r&&r(i)}}()},dom.tabs=function(t){var i=dom.find(t);if(null!=i)for(var r=i.getAttribute("data-tab-active-class"),e=0;e<i.children.length;e++)!function(){var n=i.children[e];n.addEventListener("click",function(t){for(var e=0;e<i.children.length;e++)i.children[e].classList.remove(r);n.classList.add(r)})}()},dom.top=function(t){var e=null;return null==(e="string"==typeof t?document.querySelector(t):t)?0:(t=e.offsetTop,void 0!==e.offsetParent&&(t+=dom.top(e.offsetParent)),t)},dom.formdata=function(t,e){var n=null,n="string"==typeof t?document.querySelector(t):t;if(void 0===e){for(var i={},r={},a=n.querySelectorAll("input"),o=0;o<a.length;o++){var s=a[o],l=s.name,d=s.type,c=s.value;"text"==d||"number"==d||"password"==d||"hidden"==d?(i[l]=null,""!=c?-1!=l.indexOf("[]")?i[l]=[c]:i[l]=c:i[l]=""):"radio"==d?s.checked&&(i[l]=c):"checkbox"==d&&(void 0===r[l]&&(r[l]=0),s.checked&&(void 0===i[l]&&(r[l]=0,i[l]=[]),i[l].push(c)),r[l]+=1)}for(var u=n.querySelectorAll("select"),p=0;p<u.length;p++){var h=u[p],f=h.name;i[f]=null,-1!=h.selectedIndex?-1!=f.indexOf("[]")?i[f]=[h.value]:i[f]=h.value:i[f]=""}for(var m,g,y=n.querySelectorAll("textarea"),v=0;v<y.length;v++){var b=y[v],w=b.name;i[w]=null,i[w]=b.value}for(m in r)-1==m.indexOf("[]")&&1==r[m]&&i[m]&&(i[m]=i[m][0]);for(g in i)"string"==typeof i[g]&&0==i[g].indexOf("${")&&(i[g]=i[i[g].substring(2,i[g].length-1)]);return i}function x(t,e,n){null!=(t=dom.find("[name='"+e+"']",t))&&(1<t.length&&"radio"==t[0].type&&t.forEach(function(t,e){t.value===n?t.checked=!0:t.checked=!1}),"INPUT"==t.tagName?"check"!=t.type&&(t.value=n||""):"SELECT"==t.tagName?$("select[name='"+e+"']").val(n).trigger("change"):"TEXTAREA"==t.tagName&&(t.innerHTML=n))}for(var E in e)if("object"===_typeof(e[E]))for(var O in e[E])x(n,E+"."+O,e[E][O]);else x(n,E,e[E])},dom.enable=function(t){for(var e=document.querySelectorAll(t),n=0;n<e.length;n++)e[n].disabled=!1},dom.disable=function(t){for(var e="string"==typeof t?document.querySelectorAll(t):t,n=0;n<e.length;n++)e[n].disabled=!0},dom.index=function(t,e,n){t="string"==typeof t?dom.find(t):t;if(!n)for(var i=t.getAttribute(e),r=t.parentElement.querySelectorAll(t.tagName),a=0;a<r.length;a++)if(i==r[a].getAttribute(e))return a;return-1},dom.elementAt=function(t,e,n){for(var i=document.querySelectorAll(t),r=0;r<i.length;r++){var a=i[r];if(n==a.getAttribute(e))return{index:r,element:a}}return null},dom.elementAtTree=function(t,e,n,i,r){for(var a=document.querySelectorAll(t),o=0,s=0;s<a.length;s++){var l=a[s],d=l.getAttribute(e),c=l.getAttribute(n);if(r==c&&(o++,i==d))return{index:o,element:l}}},dom.autoheight=function(t,e,n){n=n||0;t=dom.find(t);if(null!=t){var i=(e=e||document.body).getBoundingClientRect(),r=i.height;e===document.body&&(r=window.innerHeight);(l=t.parentElement).getBoundingClientRect();for(var a=t.getBoundingClientRect(),a=(parseInt(l.offsetTop),a.top-i.top),o=0;l!==e&&l;)var s=getComputedStyle(l),o=(o=(o+=parseInt(s.paddingBottom))+parseInt(s.marginBottom))+parseInt(s.borderBottomWidth),l=l.parentElement;i=getComputedStyle(t);o+=parseInt(i.borderBottomWidth),t.style.height=r-o-n-a+"px",t.style.overflowY="auto"}},dom.templatize=function(t,e){t=Handlebars.compile(t)(e);return dom.element(t)},dom.popup=function(t,e){var n=dom.create("div","full-width","full-height","position-absolute");return n.style.background="transparent",dom.bind(n,"click",function(t){n.remove(),e.remove()}),document.body.appendChild(n),t.appendChild(e),n},dom.init=function(t,e){if(e){var n=e.getAttribute("name"),n=((n=n&&""!=n?n:e.getAttribute("widget-id"))&&""!=n&&(t[n]=e),e.getAttribute("widget-model-tooltip"));n&&""!=n&&tippy(e,{content:n});for(var i=0;i<e.children.length;i++){var r=e.children[i];dom.init(t,r)}}},dom.close=function(t){var e;"sidebar"==t&&null!=(e=dom.find("[widget-id=widgetSidebar]"))&&(e.children[0].classList.remove("in"),e.children[0].classList.add("out"),setTimeout(function(){e.remove()},300))},utils={message:function(t){if(t||0!=t.length){for(var e="",n=0;n<t.length;n++)e+=t[n].message+"<br>";return e}},prompt:function(t){if(t||0!=t.length)for(var e=0;e<t.length;e++)$(t[e].element).addClass("is-invalid")},assemble:function(t,e){if("object"===_typeof(t))for(var n in t){var i=t[n];"object"===_typeof(i)&&(t[n+"Id"]=i.id),"id"==n?t[e+"Id"]=i:"name"==n&&(t[e+"Name"]=i)}},nameAttr:function(t){for(var e=[],n="",i=0;i<t.length;i++){var r=t.charAt(i);r==r.toUpperCase()?(e.push(n),n="",n+=r.toLowerCase()):n+=r}return""!=n&&e.push(n),"data-model-"+e.join("-")},nameVar:function(t,e){if(-1==t.indexOf(e=e||"-"))return t;for(var n=t.split(e),i="",r=0;r<n.length;r++){var a=n[r];i+=0==r?a:a.charAt(0).toUpperCase()+a.slice(1)}return i},camelcase:function(t,e){if(-1==t.indexOf(e))return t;for(var n=t.split(e),i="",r=0;r<n.length;r++){var a=n[r];i+=0==r?a:a.charAt(0).toUpperCase()+a.slice(1)}return i},pascalcase:function(t,e){if(-1==t.indexOf(e))return t.charAt(0).toUpperCase()+t.slice(1);for(var n=t.split(e),i="",r=0;r<n.length;r++){var a=n[r];i+=a.charAt(0).toUpperCase()+a.slice(1)}return i},clone:function(t,e){for(var n in t=t||{})e[n]=t[n]},get:function(t){for(var e=Array.prototype.slice.call(arguments,1),n={},i=0;i<e.length;i++)n[e[i]]=t[e[i]];return n},isEmpty:function(t){var e,n=0;for(e in t)n++;return 0==n},isBlank:function(t){var e,n=0;for(e in t)null!=t[e]&&""!==t[e]&&n++;return 0==n},getParameter:function(t,e){e=e.replace(/[\[\]]/g,"\\$&");e=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null},getParameters:function(t){if(-1==t.indexOf("?"))return{};for(var e={},n=(t=t.substring(t.indexOf("?")+1)).split("&"),i=0;i<n.length;i++){var r=n[i].split("=");if(1==r.length)return{};e[r[0].trim()]=decodeURIComponent(r[1].trim())}return e},isExisting:function(t,e,n){for(var i=0;i<t.length;i++)if(t[i][n]===e[n])return!0;return!1},textSize:function(t,e){var n=document.createElement("canvas"),i=n.getContext("2d"),e=(i.font=e,i.measureText(t));return n.remove(),{width:e.width,height:e.height}},base64:function(i){return new Promise(function(t,e){var n=new FileReader;n.readAsDataURL(i),n.onload=function(){return t(n.result)},n.onerror=e})},randomId:function(){for(var t="",e="abcdefghijklmnopqrstuvwxyz",n=e.length,i=0,r=0;r<2;r++){for(i=0;i<6;)t+=e.charAt(Math.floor(Math.random()*n)),i+=1;t+="_"}return t.substring(0,t.length-1)},camelcaseAttribute:function(t,e){return t=t.toLowerCase(),"id"!=(e=e.toLowerCase())&&"name"!=e&&"type"!=e||(e=t+"_"+e),utils.camelcase(e,"_")},nameAttribute:function(t,e,n){var i="",r="";return(n=n||"").startsWith("&")&&(i=n.substring(1,n.indexOf("(")),r=n.substring(n.indexOf("(")+1,n.indexOf(")"))),t=t.toLowerCase(),e=e.toLowerCase(),e="id"!=(e=""!==i?e===i?i+"_"+r:e+"_"+i+"_"+r:e)&&"name"!=e&&"type"!=e?e:t+"_"+e},safeValue:function(t,e){if(!t)return"";for(var n=e.split("."),i=t,r=0;r<n.length;r++)if(!(i=i[n[r]]))return"";return i||""},safeSet:function(t,e,n){if(n){for(var i=e.split("."),r=t,a=0;a<i.length;a++)a==i.length-1?r[i[a]]=n:(void 0===t[i[a]]&&(t[i[a]]={}),r=t[i[a]]);return t}},merge:function(t,e){var n,i=_objectSpread({},t);for(n in e){var r=e[n],a=_typeof(r);"string"===a||"number"===a||"boolean"===a?i[n]=r:"object"===a&&(i[n]=utils.merge(i[n],r))}return i}};var NO_ERRORS=0,REQUIRED_ERROR=1,FORMAT_ERROR=2,INVALID_ERROR=3;function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return o};var l,o={},t=Object.prototype,d=t.hasOwnProperty,c=Object.defineProperty||function(t,e,n){t[e]=n.value},e="function"==typeof Symbol?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",r=e.toStringTag||"@@toStringTag";function a(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(l){a=function(t,e,n){return t[e]=n}}function s(t,e,n,i){var r,a,o,s,e=e&&e.prototype instanceof y?e:y,e=Object.create(e.prototype),i=new C(i||[]);return c(e,"_invoke",{value:(r=t,a=n,o=i,s=p,function(t,e){if(s===f)throw Error("Generator is already running");if(s===m){if("throw"===t)throw e;return{value:l,done:!0}}for(o.method=t,o.arg=e;;){var n=o.delegate;if(n){n=function t(e,n){var i=n.method,r=e.iterator[i];if(r===l)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=l,t(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;i=u(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;r=i.arg;return r?r.done?(n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,g):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}(n,o);if(n){if(n===g)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(s===p)throw s=m,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s=f;n=u(r,a,o);if("normal"===n.type){if(s=o.done?m:h,n.arg===g)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(s=m,o.method="throw",o.arg=n.arg)}})}),e}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}o.wrap=s;var p="suspendedStart",h="suspendedYield",f="executing",m="completed",g={};function y(){}function v(){}function b(){}var e={},w=(a(e,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(A([]))),x=(w&&w!==t&&d.call(w,i)&&(e=w),b.prototype=y.prototype=Object.create(e));function E(t){["next","throw","return"].forEach(function(e){a(t,e,function(t){return this._invoke(e,t)})})}function O(o,s){var e;c(this,"_invoke",{value:function(n,i){function t(){return new s(function(t,e){!function e(t,n,i,r){var a,t=u(o[t],o,n);if("throw"!==t.type)return(n=(a=t.arg).value)&&"object"==_typeof(n)&&d.call(n,"__await")?s.resolve(n.__await).then(function(t){e("next",t,i,r)},function(t){e("throw",t,i,r)}):s.resolve(n).then(function(t){a.value=t,i(a)},function(t){return e("throw",t,i,r)});r(t.arg)}(n,i,t,e)})}return e=e?e.then(t,t):t()}})}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function A(e){if(e||""===e){var n,t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return n=-1,(t=function t(){for(;++n<e.length;)if(d.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=l,t.done=!0,t}).next=t}throw new TypeError(_typeof(e)+" is not iterable")}return c(x,"constructor",{value:v.prototype=b,configurable:!0}),c(b,"constructor",{value:v,configurable:!0}),v.displayName=a(b,r,"GeneratorFunction"),o.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,a(t,r,"GeneratorFunction")),t.prototype=Object.create(x),t},o.awrap=function(t){return{__await:t}},E(O.prototype),a(O.prototype,n,function(){return this}),o.AsyncIterator=O,o.async=function(t,e,n,i,r){void 0===r&&(r=Promise);var a=new O(s(t,e,n,i),r);return o.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},E(x),a(x,r,"Generator"),a(x,i,function(){return this}),a(x,"toString",function(){return"[object Generator]"}),o.keys=function(t){var e,n=Object(t),i=[];for(e in n)i.push(e);return i.reverse(),function t(){for(;i.length;){var e=i.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},o.values=A,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&d.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var i=this;function t(t,e){return a.type="throw",a.arg=n,i.next=t,e&&(i.method="next",i.arg=l),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e],a=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var o=d.call(r,"catchLoc"),s=d.call(r,"finallyLoc");if(o&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(o){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&d.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var a=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc?null:r)?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n,i,r=this.tryEntries[e];if(r.tryLoc===t)return"throw"===(n=r.completion).type&&(i=n.arg,_(r)),i}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=l),g}},o}function asyncGeneratorStep(t,e,n,i,r,a,o){try{var s=t[a](o),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(s){return function(){var t=this,o=arguments;return new Promise(function(e,n){var i=s.apply(t,o);function r(t){asyncGeneratorStep(i,e,n,r,a,"next",t)}function a(t){asyncGeneratorStep(i,e,n,r,a,"throw",t)}r(void 0)})}}function ownKeys(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return o};var l,o={},t=Object.prototype,d=t.hasOwnProperty,c=Object.defineProperty||function(t,e,n){t[e]=n.value},e="function"==typeof Symbol?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",r=e.toStringTag||"@@toStringTag";function a(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(l){a=function(t,e,n){return t[e]=n}}function s(t,e,n,i){var r,a,o,s,e=e&&e.prototype instanceof y?e:y,e=Object.create(e.prototype),i=new C(i||[]);return c(e,"_invoke",{value:(r=t,a=n,o=i,s=p,function(t,e){if(s===f)throw Error("Generator is already running");if(s===m){if("throw"===t)throw e;return{value:l,done:!0}}for(o.method=t,o.arg=e;;){var n=o.delegate;if(n){n=function t(e,n){var i=n.method,r=e.iterator[i];if(r===l)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=l,t(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;i=u(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;r=i.arg;return r?r.done?(n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,g):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}(n,o);if(n){if(n===g)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(s===p)throw s=m,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s=f;n=u(r,a,o);if("normal"===n.type){if(s=o.done?m:h,n.arg===g)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(s=m,o.method="throw",o.arg=n.arg)}})}),e}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}o.wrap=s;var p="suspendedStart",h="suspendedYield",f="executing",m="completed",g={};function y(){}function v(){}function b(){}var e={},w=(a(e,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(A([]))),x=(w&&w!==t&&d.call(w,i)&&(e=w),b.prototype=y.prototype=Object.create(e));function E(t){["next","throw","return"].forEach(function(e){a(t,e,function(t){return this._invoke(e,t)})})}function O(o,s){var e;c(this,"_invoke",{value:function(n,i){function t(){return new s(function(t,e){!function e(t,n,i,r){var a,t=u(o[t],o,n);if("throw"!==t.type)return(n=(a=t.arg).value)&&"object"==_typeof(n)&&d.call(n,"__await")?s.resolve(n.__await).then(function(t){e("next",t,i,r)},function(t){e("throw",t,i,r)}):s.resolve(n).then(function(t){a.value=t,i(a)},function(t){return e("throw",t,i,r)});r(t.arg)}(n,i,t,e)})}return e=e?e.then(t,t):t()}})}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function A(e){if(e||""===e){var n,t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return n=-1,(t=function t(){for(;++n<e.length;)if(d.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=l,t.done=!0,t}).next=t}throw new TypeError(_typeof(e)+" is not iterable")}return c(x,"constructor",{value:v.prototype=b,configurable:!0}),c(b,"constructor",{value:v,configurable:!0}),v.displayName=a(b,r,"GeneratorFunction"),o.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,a(t,r,"GeneratorFunction")),t.prototype=Object.create(x),t},o.awrap=function(t){return{__await:t}},E(O.prototype),a(O.prototype,n,function(){return this}),o.AsyncIterator=O,o.async=function(t,e,n,i,r){void 0===r&&(r=Promise);var a=new O(s(t,e,n,i),r);return o.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},E(x),a(x,r,"Generator"),a(x,i,function(){return this}),a(x,"toString",function(){return"[object Generator]"}),o.keys=function(t){var e,n=Object(t),i=[];for(e in n)i.push(e);return i.reverse(),function t(){for(;i.length;){var e=i.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},o.values=A,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&d.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var i=this;function t(t,e){return a.type="throw",a.arg=n,i.next=t,e&&(i.method="next",i.arg=l),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e],a=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var o=d.call(r,"catchLoc"),s=d.call(r,"finallyLoc");if(o&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(o){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&d.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var a=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc?null:r)?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n,i,r=this.tryEntries[e];if(r.tryLoc===t)return"throw"===(n=r.completion).type&&(i=n.arg,_(r)),i}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=l),g}},o}function asyncGeneratorStep(t,e,n,i,r,a,o){try{var s=t[a](o),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(s){return function(){var t=this,o=arguments;return new Promise(function(e,n){var i=s.apply(t,o);function r(t){asyncGeneratorStep(i,e,n,r,a,"next",t)}function a(t){asyncGeneratorStep(i,e,n,r,a,"throw",t)}r(void 0)})}}function CascadeSelect(o){var h=o.levels,s=o.values,i=(o.readonly,o.container),f=i.getBoundingClientRect().width,m=o.levels.length,g=o.validate;function y(){t.apply(this,arguments)}function t(){return(t=_asyncToGenerator(_regeneratorRuntime().mark(function t(c,e,n){var u,i,r,a,o,s,l,d,p;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(document.querySelectorAll(".cascadeselect-link").forEach(function(t,e){t.style.borderBottom="none"}),c.style.borderBottom="2px solid #1976D2",dom.model(c,e),o=c.getAttribute("data-url"),(e=e||{}).cascadeIndex=c.getAttribute("data-cascade-index"),u=c.parentElement.parentElement,null==(i=dom.find(".cascadeselect-popup"))&&((i=dom.create("div","row","b-a-1","mt-0","cascadeselect-popup")).style.overflowY="auto",i.style.width=f+"px",i.style.maxHeight="200px",i.style.position="fixed",i.style.zIndex=99999,i.style.backgroundColor="white"),i.style.display="",i.innerHTML="",r={},e._and_condition?(r._and_condition=e._and_condition,r._other_select=e._other_select):r=e,r[c.getAttribute("data-cascade-field-value")]="",o&&"undefined"!==o)return t.next=17,xhr.post({url:o,params:r});t.next=20;break;case 17:a=t.sent,t.next=22;break;case 20:0===parseInt(c.getAttribute("data-cascade-index"))?s=n:(o=c.getAttribute("data-cascade-options"))?s=JSON.parse(o):(s=n,c.setAttribute("data-cascade-options",JSON.stringify(n)));case 22:for(s=a.data,l=0;l<s.length;l++)d=s[l],p=dom.create("a","btn","btn-link"),d[c.getAttribute("data-cascade-field-text")]&&(p.innerText=d[c.getAttribute("data-cascade-field-text")]),dom.model(p,d),p.addEventListener("click",function(t){var e=parseInt(c.getAttribute("data-cascade-index")),n=c.getAttribute("data-cascade-name"),i=c.getAttribute("data-cascade-field-value"),r=c.getAttribute("data-cascade-field-text"),a=dom.model(this);if(c.setAttribute("data-cascade-value",a[i]),a[r]&&(c.innerText=a[r]),dom.find("input",c.parentElement).value=a[i],dom.model(c,a),e<m-1){var o,r=dom.find('a[data-cascade-index="'+(e+1)+'"]',u),s=(r.setAttribute("data-cascade-value",""),r.innerText="请选择",dom.find("input",r.parentElement).value="",{}),l=(s[n]=a[i],{});for(o in h[e+1].params){var d=Handlebars.compile(h[e+1].params[o]);l[o]=d(s)}r.removeAttribute("data-cascade-options"),a.children?y(r,l,JSON.parse(a.children),e):y(r,l,e),t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault()}g&&g(c.parentElement.parentElement)}),i.appendChild(p);u.appendChild(i);case 25:case"end":return t.stop()}},t)}))).apply(this,arguments)}for(var e=0;e<h.length;e++)!function(r){var t=h[r],e=dom.create("div"),a=(e.style.width=t.width,e.style.height="18px",e.style.display="inline-block",e.style.textAlign="center",e.style.textOverflow="ellipsis",e.style.overflow="hidden",e.style.whiteSpace="nowrap",dom.create("a","btn","pb-1","cascadeselect-link")),n=(a.style.paddingTop="0",a.style.border="none",a.style.position="relative",a.style.top="-2px",t.url&&a.setAttribute("data-url",t.url),a.setAttribute("data-cascade-index",r),a.setAttribute("data-cascade-name",t.name),a.setAttribute("data-cascade-field-value",t.fields.value),a.setAttribute("data-cascade-field-text",t.fields.text),a.style.borderRadius="unset",dom.model(a,t.params||{}),t.value&&t.value[t.fields.text]?(a.innerText=t.value[t.fields.text],a.setAttribute("data-cascade-value",t.value[t.fields.value]||t.value[t.name])):a.innerText=t.text,a.addEventListener("click",function(){if(!o.readonly){var t,e=dom.model(this);if(0<=r-1){var n=dom.find("a",a.parentElement.previousElementSibling.previousElementSibling),i=n.getAttribute("data-cascade-value");if(null==i||""==i)return;e[n.getAttribute("data-cascade-name")]=i}for(t in e)0!=t.indexOf("_")&&t!=h[r].fields.value&&delete e[t];y(this,e,s)}}),r!=h.length-1&&(e.style.marginRight="5px"),0<r&&(e.style.marginLeft="3px"),dom.create("input"));n.setAttribute("type","hidden"),o.required&&n.setAttribute("data-required",t.text),n.setAttribute("name",t.name),t.value&&t.value[t.fields.value]&&(n.value=t.value[t.fields.value]),e.appendChild(a),e.appendChild(n),i.appendChild(e),r!=h.length-1&&((t=dom.create("span")).textContent="/",t.style.position="absolute",t.style.top="4px",i.append(t)),g&&g(a.parentElement.parentElement)}(e);function n(t){-1==document.elementFromPoint(t.clientX,t.clientY).className.indexOf("cascadeselect")&&null!=(t=dom.find(".cascadeselect-popup"))&&(document.querySelectorAll(".cascadeselect-link").forEach(function(t,e){t.style.borderBottom="none"}),t.remove())}document.removeEventListener("click",n),document.addEventListener("click",n)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _createForOfIteratorHelper(t,e){var n,i,r,a,o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(o)return r=!(i=!0),{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){r=!0,n=t},f:function(){try{i||null==o.return||o.return()}finally{if(r)throw n}}};if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return o&&(t=o),a=0,{s:e=function(){},n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var n;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(n="Object"===(n={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function _regeneratorRuntime(){_regeneratorRuntime=function(){return o};var l,o={},t=Object.prototype,d=t.hasOwnProperty,c=Object.defineProperty||function(t,e,n){t[e]=n.value},e="function"==typeof Symbol?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",r=e.toStringTag||"@@toStringTag";function a(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(l){a=function(t,e,n){return t[e]=n}}function s(t,e,n,i){var r,a,o,s,e=e&&e.prototype instanceof y?e:y,e=Object.create(e.prototype),i=new C(i||[]);return c(e,"_invoke",{value:(r=t,a=n,o=i,s=p,function(t,e){if(s===f)throw Error("Generator is already running");if(s===m){if("throw"===t)throw e;return{value:l,done:!0}}for(o.method=t,o.arg=e;;){var n=o.delegate;if(n){n=function t(e,n){var i=n.method,r=e.iterator[i];if(r===l)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=l,t(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;i=u(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;r=i.arg;return r?r.done?(n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,g):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}(n,o);if(n){if(n===g)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(s===p)throw s=m,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s=f;n=u(r,a,o);if("normal"===n.type){if(s=o.done?m:h,n.arg===g)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(s=m,o.method="throw",o.arg=n.arg)}})}),e}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}o.wrap=s;var p="suspendedStart",h="suspendedYield",f="executing",m="completed",g={};function y(){}function v(){}function b(){}var e={},w=(a(e,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(A([]))),x=(w&&w!==t&&d.call(w,i)&&(e=w),b.prototype=y.prototype=Object.create(e));function E(t){["next","throw","return"].forEach(function(e){a(t,e,function(t){return this._invoke(e,t)})})}function O(o,s){var e;c(this,"_invoke",{value:function(n,i){function t(){return new s(function(t,e){!function e(t,n,i,r){var a,t=u(o[t],o,n);if("throw"!==t.type)return(n=(a=t.arg).value)&&"object"==_typeof(n)&&d.call(n,"__await")?s.resolve(n.__await).then(function(t){e("next",t,i,r)},function(t){e("throw",t,i,r)}):s.resolve(n).then(function(t){a.value=t,i(a)},function(t){return e("throw",t,i,r)});r(t.arg)}(n,i,t,e)})}return e=e?e.then(t,t):t()}})}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function A(e){if(e||""===e){var n,t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return n=-1,(t=function t(){for(;++n<e.length;)if(d.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=l,t.done=!0,t}).next=t}throw new TypeError(_typeof(e)+" is not iterable")}return c(x,"constructor",{value:v.prototype=b,configurable:!0}),c(b,"constructor",{value:v,configurable:!0}),v.displayName=a(b,r,"GeneratorFunction"),o.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,a(t,r,"GeneratorFunction")),t.prototype=Object.create(x),t},o.awrap=function(t){return{__await:t}},E(O.prototype),a(O.prototype,n,function(){return this}),o.AsyncIterator=O,o.async=function(t,e,n,i,r){void 0===r&&(r=Promise);var a=new O(s(t,e,n,i),r);return o.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},E(x),a(x,r,"Generator"),a(x,i,function(){return this}),a(x,"toString",function(){return"[object Generator]"}),o.keys=function(t){var e,n=Object(t),i=[];for(e in n)i.push(e);return i.reverse(),function t(){for(;i.length;){var e=i.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},o.values=A,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&d.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var i=this;function t(t,e){return a.type="throw",a.arg=n,i.next=t,e&&(i.method="next",i.arg=l),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e],a=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var o=d.call(r,"catchLoc"),s=d.call(r,"finallyLoc");if(o&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(o){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&d.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var a=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc?null:r)?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n,i,r=this.tryEntries[e];if(r.tryLoc===t)return"throw"===(n=r.completion).type&&(i=n.arg,_(r)),i}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=l),g}},o}function asyncGeneratorStep(t,e,n,i,r,a,o){try{var s=t[a](o),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(s){return function(){var t=this,o=arguments;return new Promise(function(e,n){var i=s.apply(t,o);function r(t){asyncGeneratorStep(i,e,n,r,a,"next",t)}function a(t){asyncGeneratorStep(i,e,n,r,a,"throw",t)}r(void 0)})}}String.prototype.trim||!function(){var t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(t,"")}}(),Validation={validate:function(t,e){var o=[],n=(void 0===t&&(t=$(document)),(t=$(t)).find("input[type!=checkbox][type!=radio][type!=button]").each(function(t,e){var n=$(e).val().trim(),i=Validation.getLabel(e),r=$(e).attr("data-required-message")?$(e).attr("data-required-message"):i+"必须填写！",a=(Validation.isRequired(e)&&""===n&&o.push({element:e,message:r}),$(e).attr("data-domain-type"));if(a){r=i+"填写不合要求。",i=Validation.getDomainValidator(new ValidationModel(a));if(null!=i&&""!==n){a=i.test(n);switch(a){case REQUIRED_ERROR:break;case FORMAT_ERROR:r=$(e).attr("data-format-message")?$(e).attr("data-format-message"):r;break;case INVALID_ERROR:r=$(e).attr("data-invalid-message")?$(e).attr("data-invalid-message"):r}a!=NO_ERRORS&&o.push({element:$(e),message:r})}}}),t.find("textarea").each(function(t,e){var n=$(e).val().trim(),i=Validation.getLabel(e),r=$(e).attr("data-required-message")?$(e).attr("data-required-message"):i+"必须填写！",a=(Validation.isRequired(e)&&""===n&&o.push({element:e,message:r}),$(e).attr("data-domain-type"));if(a){r=i+"填写不合要求。",i=Validation.getDomainValidator(new ValidationModel(a));if(null!=i&&""!==n){a=i.test(n);switch(a){case REQUIRED_ERROR:break;case FORMAT_ERROR:r=$(e).attr("data-format-message")?$(e).attr("data-format-message"):r;break;case INVALID_ERROR:r=$(e).attr("data-invalid-message")?$(e).attr("data-invalid-message"):r}a!=NO_ERRORS&&o.push({element:$(e),message:r})}}}),t.find("select").each(function(t,e){var n;!Validation.isRequired(e)||"-1"!=$(e).val()&&""!=$(e).val()&&null!=$(e).val()||(n=Validation.getLabel(e)+"必须选择！",n=$(e).attr("data-required-message")?$(e).attr("data-required-message"):n,o.push({element:$(e),message:n}))}),{});for(s in t.find("input[type=checkbox]").each(function(t,e){e=$(e).attr("name");n[e]=e}),n){var i=!1,r=null,a=null;t.find('input[name="'+s+'"]').each(function(t,e){0==t&&(r=Validation.getLabel(e),a=e),!i&&$(e).prop("checked")&&(i=!0)}),!i&&Validation.isRequired(a)&&(l=r+"必须选择！",l=$(a).attr("data-required-message")?$(a).attr("data-required-message"):l,o.push({element:$(a),message:l}))}var s,n={};for(s in t.find("input[type=radio]").each(function(t,e){e=$(e).attr("name");n[e]=e}),n){var l,i=!1,r=null,a=null;t.find('input[name="'+s+'"]').each(function(t,e){0==t&&(r=Validation.getLabel(e),a=e),!i&&$(e).prop("checked")&&(i=!0)}),!1===i&&$(a).prop("required")&&(l=r+"必须选择！",l=$(a).attr("data-required-message")?$(a).attr("data-required-message"):l,o.push({element:$(a),message:l}))}return t.find("input[remote]").each(function(t,e){var n=$(e).attr("remote"),i=$(e).val().trim();n&&""!=n&&""!=i&&$.ajax({url:n,method:"POST",data:"check="+i,success:function(t){t=$.parseJSON(t);t.err&&o.push({element:$(e),message:t.msg})}})}),e&&e(o),o},getLabel:function(t){t=$(t);return t.attr("label")||$(t).attr("data-required")||t.attr("name")||t.attr("id")},isRequired:function(t){t=$(t);return!!t.prop("required")||"required"==t.attr("required")||void 0!==t.attr("data-required")&&""!=t.attr("data-required")},getDomainValidator:function(t){var e=t.keyword.toLowerCase(),n=null;if("mail"===e||"email"===e)n=new Validation.Mail;else if("number"===e)n=new Validation.Number(t.symbol,t.args);else if("string"===e)n=new Validation.String(t.args);else if("mobile"===e)n=new Validation.Mobile;else if("range"===e)n=new Validation.Range(t.opts,t.args);else if("phone"===e)n=new Validation.Phone;else if("cmpexp"===e)n=new Validation.CmpExp(t.args[0],t.args[1]);else if("regexp"===e)n=new Validation.RegExp(t.args[0]);else if("remote"===e)n=new Validation.Remote(t.args[0]);else if("date"===e)n=new Validation.Date;else if("time"===e)n=new Validation.Time;else{if("datetime"!==e)throw new Error('not support for the domain("'+e+'")');n=new Validation.DateTime}return n},String:function(t){this.min=0,this.max=parseInt(t[0]),1<t.length&&(this.min=parseInt(t[0]),this.max=parseInt(t[1])),this.test=function(t){return t.length<this.min||this.max&&t.length>this.max?FORMAT_ERROR:NO_ERRORS}},Number:function(t,e){this.plus=-1,this.minus=-1,"-"===t?this.minus=0:"+"===t&&(this.plus=0),0!=this.minus&&this.plus,this.precision=parseInt(e[0]),1<e.length&&(this.scale=parseInt(e[1])),this.test=function(t){if(0==this.plus){if(!/^\s*(\+)?((\d+(\.\d+)?)|(\.\d+))\s*$/.test(t))return FORMAT_ERROR}else if(0==this.minus){if(!/^\s*(-)((\d+(\.\d+)?)|(\.\d+))\s*$/.test(t))return FORMAT_ERROR}else if(!/^\s*(\+)?((\d+(\.\d+)?)|(\.\d+))\s*$/.test(t))return FORMAT_ERROR;var e=t.indexOf("."),n=-1==e?this.precision:this.precision+1,n=0==this.plus||0==this.minus?n+1:n;if(t.length>n)return FORMAT_ERROR;if(-1!=e&&this.scale&&t.substring(e+1).length>this.scale)return FORMAT_ERROR;return NO_ERRORS}},Mail:function(){this.test=function(t){return/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(t)?NO_ERRORS:FORMAT_ERROR}},Phone:function(){this.test=function(t){return/^\d{11}$/i.test(t)?NO_ERRORS:FORMAT_ERROR}},Mobile:function(){this.test=function(t){return/^\d{11}$/i.test(t)?NO_ERRORS:FORMAT_ERROR}},Date:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){this.test=function(t){return/^\d{4}-\d{1,2}-\d{1,2}$/.test(t)?isNaN(Date.parse(t))?INVALID_ERROR:NO_ERRORS:FORMAT_ERROR}}),Time:function(){this.test=function(t){return/^\d{1,2}:\d{1,2}(:\d{1,2})?$/.test(t)?(t="1970-01-01 "+t,isNaN(Date.parse(t))?INVALID_ERROR:NO_ERRORS):FORMAT_ERROR}},DateTime:function(){this.test=function(t){return/^\d{4}-\d{1,2}-\d{1,2} \d{1,2}:\d{1,2}(:\d{1,2})?$/.test(t)?isNaN(Date.parse(t))?INVALID_ERROR:NO_ERRORS:FORMAT_ERROR}},RegExp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(t){this.re=new RegExp(t),this.test=function(t){return this.re.test(t)?NO_ERRORS:FORMAT_ERROR}}),CmpExp:function CmpExp(type,expr){this.model=new ValidationModel(type),this.expr=expr,this.ignore=!1;var self=this;this.test=function(str){var expr=this.expr,dt=Validation.getDomainValidator(this.model);if(dt.test(str)!=NO_ERRORS)return FORMAT_ERROR;if($("input[type!=checkbox][type!=radio][type!=button]").each(function(t,e){var n=$(e).attr("name"),e=$(e).val();-1!=expr.indexOf(n)&&(""==e&&(self.ignore=!0),expr=expr.replace(new RegExp(n,"g"),e))}),!this.ignore)try{if(!eval(expr))return INVALID_ERROR}catch(e){return INVALID_ERROR}return NO_ERRORS}},Remote:function(e){this.test=function(t){$.ajax({url:e+t,dataType:"json",success:function(t){t.error}})}},Range:function(n,t){this.min=parseFloat(t[0]),this.max=parseFloat(t[1]),this.test=function(t){var e,t=parseFloat(t.trim());return!isNaN(t)&&(e=!1,">"==n[0]?e=t>this.min:">="===n[0]&&(e=t>=this.min),e)&&("<"==n[1]?e=t<this.max:"<="===n[1]&&(e=t<=this.max),e)?NO_ERRORS:INVALID_ERROR}}},ValidationModel=function(t){this.symbol="",this.keyword="",this.opts=[],this.args=[],this.unary_ops={"+":!0,"-":!0},this.keywords={string:!0,number:!0,range:!0,regexp:!0,mobile:!0,email:!0,phone:!0,cmpexp:!0};for(var e=0,n=t.length,i="";e<n;){var r=t.charAt(e);if(this.isUnaryOp(r)&&0==e)this.symbol=r;else if("["==r)if(""!=this.keyword)i+=r;else{if(!this.stringEqual("range",i))throw new Error('"[" is just available for range.');this.keyword=i,this.opts.push(">="),i=""}else"("==r?""!=this.keyword?(this.opts.push("("),i+=r):(this.keyword=i,this.opts.push(">"),i=""):"]"==r?(this.opts.push("<="),this.args.push(i),i=""):")"==r&&e==n-1?(this.args.push(i),this.opts.push("<"),i=""):")"==r?(this.opts.pop("<"),1==this.opts.length&&(i+=r)):","==r&&1==this.opts.length?(this.args.push(i),i=""):i+=r;e++}""==this.keyword&&(this.keyword=i)},ValidationModel.prototype={isKeyword:function(t){return this.keywords[t.toLowerCase()]},isUnaryOp:function(t){return this.unary_ops[t]},isDecimalDigit:function(t){return 48<=t&&t<=57},isIdentifierStart:function(t){return 36===t||95===t||65<=t&&t<=90||97<=t&&t<=122},isIdentifierPart:function(t){return 36===t||95===t||65<=t&&t<=90||97<=t&&t<=122||48<=t&&t<=57},stringEqual:function(t,e){return t.toLowerCase()===e.toLowerCase()}},xhr={url:function(t){return t="undefined"!=typeof HOST&&-1==t.indexOf("http")?HOST+t:t},params:function(t){if(-1==t.indexOf("?"))return{};for(var e={},n=(t=t.substring(t.indexOf("?")+1)).split("&"),i=0;i<n.length;i++){var r=n[i].split("=");if(1==r.length)return{};e[r[0].trim()]=decodeURIComponent(r[1].trim())}return e},request:function(r,a){var o=xhr.url(r.url),t=xhr.params(o),s=r.data||r.params||{},l=r.type||"json",s=(r.success,r.error,_objectSpread(_objectSpread({},t),s));return new Promise(function(e,n){var i=new XMLHttpRequest;if(i.onload=function(){var t=i.responseText;if("json"==l)try{t=JSON.parse(t)}catch(t){return console.log(t),void n(t)}(4==i.readyState&&"200"==i.status?e:n)(t)},i.onerror=function(){n({error:{code:-500,message:"网络访问错误！"}})},i.ontimeout=function(){n({error:{code:-501,message:"网络请求超时！"}})},i.open(a,o,!0),i.setRequestHeader("Content-Type","application/json"),r.headers)for(var t in r.headers)i.setRequestHeader(t,r.headers[t]);s?i.send(JSON.stringify(s)):i.send(null)})}},xhr.get=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var i;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.url,e.data,e.success,e.error,t.abrupt("return",new Promise(function(t,e){var n=new XMLHttpRequest;n.open("GET",i,!0),n.onload=function(){t(n.responseText)},n.send(null)}));case 5:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),xhr.post=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",xhr.request(e,"POST"));case 1:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),xhr.put=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",xhr.request(e,"PUT"));case 1:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),xhr.patch=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",xhr.request(e,"PATCH"));case 1:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),xhr.delete=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",xhr.request(e,"DELETE"));case 1:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),xhr.connect=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",xhr.request(e,"CONNECT"));case 1:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),xhr.upload=function(e){var t,n=e.url,i=e.data||e.params,r=e.type||"json",a=e.success,o=e.error,s=new FormData;for(t in i)s.append(t,i[t]);s.append("file",e.file);var l=new XMLHttpRequest;l.onload=function(){var e=l.responseText;if("json"==r)try{e=JSON.parse(e)}catch(t){return void(o&&o(e))}4==l.readyState&&"200"==l.status?a&&a(e):o&&o(e)},e.progress&&(l.onprogress=function(t){e.progress(t.loaded,t.total)}),l.onerror=function(){o&&o({error:{code:-500,message:"网络访问错误！"}})},l.ontimeout=function(){o&&o({error:{code:-501,message:"网络请求超时！"}})},l.open("POST",n,!0),"undefined"!=typeof APPTOKEN&&l.setRequestHeader("apptoken",APPTOKEN),l.send(s)},"undefined"!=typeof module&&(module.exports={xhr:xhr});var ICON_REQUIRED='<i class="fas fa-asterisk icon-required gx-fs-12"></i>',ICON_GENERAL='<i class="fas fa-question icon-general gx-fs-12"></i>',ICON_CORRECT='<i class="fas fa-check text-success gx-fs-12" style="width: 10px;"></i>',ICON_ERROR='<i class="fas fa-exclamation text-warning gx-fs-12"style="width: 10px;"></i>';function EditableForm(t){var e=this;this.fields=t.fields,this.doSave=t.doSave||function(t){},this.doLoad=t.doLoad||function(t){},this.readonly=t.readonly||!1,this.confirmText=t.confirmText||"",this.confirm=t.confirm,this.actions=t.actions||[],this.actionable=void 0===t.actionable,this.columnCount=t.columnCount||1,this.saveText=t.saveText||"保存",this.savePromptText=t.savePromptText,this.saveOpt=t.save,this.readOpt=t.read,this.mode=t.mode||"sidebar",this.onInit=t.onInit||function(){},this.toast=dom.element('\n    <div class="toast fade b-a-1 text-white" data-autohide="false" \n         style="position: absolute; left: 20%; top: 10px; width: 60%; z-index: -1;">\n      <div class="toast-header pt-1">\n        <strong class="mr-auto p-2"></strong>\n        <button type="button" class="ml-2 mb-1 mr-2 close text-white" data-dismiss="toast">&times;</button>\n      </div>\n      <div class="toast-body p-2"></div>\n    </div>\n  '),this.controls={},dom.find("button",this.toast).addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.toast.classList.remove("show","in"),e.toast.style.zIndex=-1}),this.variableListeners={}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return o};var l,o={},t=Object.prototype,d=t.hasOwnProperty,c=Object.defineProperty||function(t,e,n){t[e]=n.value},e="function"==typeof Symbol?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",r=e.toStringTag||"@@toStringTag";function a(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(l){a=function(t,e,n){return t[e]=n}}function s(t,e,n,i){var r,a,o,s,e=e&&e.prototype instanceof y?e:y,e=Object.create(e.prototype),i=new C(i||[]);return c(e,"_invoke",{value:(r=t,a=n,o=i,s=p,function(t,e){if(s===f)throw Error("Generator is already running");if(s===m){if("throw"===t)throw e;return{value:l,done:!0}}for(o.method=t,o.arg=e;;){var n=o.delegate;if(n){n=function t(e,n){var i=n.method,r=e.iterator[i];if(r===l)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=l,t(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;i=u(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;r=i.arg;return r?r.done?(n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,g):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}(n,o);if(n){if(n===g)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(s===p)throw s=m,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s=f;n=u(r,a,o);if("normal"===n.type){if(s=o.done?m:h,n.arg===g)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(s=m,o.method="throw",o.arg=n.arg)}})}),e}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}o.wrap=s;var p="suspendedStart",h="suspendedYield",f="executing",m="completed",g={};function y(){}function v(){}function b(){}var e={},w=(a(e,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(A([]))),x=(w&&w!==t&&d.call(w,i)&&(e=w),b.prototype=y.prototype=Object.create(e));function E(t){["next","throw","return"].forEach(function(e){a(t,e,function(t){return this._invoke(e,t)})})}function O(o,s){var e;c(this,"_invoke",{value:function(n,i){function t(){return new s(function(t,e){!function e(t,n,i,r){var a,t=u(o[t],o,n);if("throw"!==t.type)return(n=(a=t.arg).value)&&"object"==_typeof(n)&&d.call(n,"__await")?s.resolve(n.__await).then(function(t){e("next",t,i,r)},function(t){e("throw",t,i,r)}):s.resolve(n).then(function(t){a.value=t,i(a)},function(t){return e("throw",t,i,r)});r(t.arg)}(n,i,t,e)})}return e=e?e.then(t,t):t()}})}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function A(e){if(e||""===e){var n,t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return n=-1,(t=function t(){for(;++n<e.length;)if(d.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=l,t.done=!0,t}).next=t}throw new TypeError(_typeof(e)+" is not iterable")}return c(x,"constructor",{value:v.prototype=b,configurable:!0}),c(b,"constructor",{value:v,configurable:!0}),v.displayName=a(b,r,"GeneratorFunction"),o.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,a(t,r,"GeneratorFunction")),t.prototype=Object.create(x),t},o.awrap=function(t){return{__await:t}},E(O.prototype),a(O.prototype,n,function(){return this}),o.AsyncIterator=O,o.async=function(t,e,n,i,r){void 0===r&&(r=Promise);var a=new O(s(t,e,n,i),r);return o.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},E(x),a(x,r,"Generator"),a(x,i,function(){return this}),a(x,"toString",function(){return"[object Generator]"}),o.keys=function(t){var e,n=Object(t),i=[];for(e in n)i.push(e);return i.reverse(),function t(){for(;i.length;){var e=i.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},o.values=A,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&d.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var i=this;function t(t,e){return a.type="throw",a.arg=n,i.next=t,e&&(i.method="next",i.arg=l),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e],a=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var o=d.call(r,"catchLoc"),s=d.call(r,"finallyLoc");if(o&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(o){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&d.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var a=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc?null:r)?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n,i,r=this.tryEntries[e];if(r.tryLoc===t)return"throw"===(n=r.completion).type&&(i=n.arg,_(r)),i}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=l),g}},o}function asyncGeneratorStep(t,e,n,i,r,a,o){try{var s=t[a](o),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(s){return function(){var t=this,o=arguments;return new Promise(function(e,n){var i=s.apply(t,o);function r(t){asyncGeneratorStep(i,e,n,r,a,"next",t)}function a(t){asyncGeneratorStep(i,e,n,r,a,"throw",t)}r(void 0)})}}EditableForm.prototype.render=function(){var n=_asyncToGenerator(_regeneratorRuntime().mark(function t(e,n){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.containerId=e,this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="",t.next=5,this.fetch(n);case 5:case"end":return t.stop()}},t,this)}));return function(t,e){return n.apply(this,arguments)}}(),EditableForm.prototype.build=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(h){var e,n,i,r,a,o,s,l,d,c,u,p,f,m,g,y,v,b,w,D,F,x,E,O,L,_,M,C,A,R,T,S,k,P,I,q,Q,H,j,G,V,N=this;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e=this,h=h||{},n=dom.create("div","col-md-12","form-horizontal"),i=this.columnCount,r=[],a=[],o=0;o<this.fields.length;o++)s=this.fields[o],l=s.value,s.name&&(-1!=s.name.indexOf("[]")?(d=s.name.substring(0,s.name.indexOf("[]")),s.value=void 0===h[d]||"null"==h[d]?null:h[d]):-1!=s.name.indexOf(".")?(d=s.name.substring(0,s.name.indexOf(".")),c=s.name.substring(s.name.indexOf(".")+1),s.value=void 0===h[d]||"null"==h[d]||void 0===h[d][c]||"null"==h[c]?null:h[d][c]):s.value=void 0===h[s.name]||"null"==h[s.name]?null:h[s.name]),!s.value&&l&&(s.value=l),("hidden"==s.input?r:a).push(s);for(u=[],p={title:"",fields:[]},f=0;f<a.length;f++)"title"===(m=a[f]).input?(u.push(p),p={title:m.title,fields:[]}):p.fields.push(m);for(0!==p.fields.length&&u.push(p),g=0;g<r.length;g++)y=r[g],(v=dom.create("input")).type="hidden",v.name=y.name,v.value=y.value,v.setAttribute("data-identifiable",y.identifiable||!1),n.appendChild(v);for(b=0;b<u.length;b++){for((w=u[b]).title&&(D=dom.element('<div class="title-bordered" style="margin: 10px -10px;"><strong>'+w.title+"</strong></div>"),n.appendChild(D)),F=24/i,x=dom.create("div","row","mx-0"),E=0;E<w.fields.length;E++)O=w.fields[E],L=this.createInput(O,i),_=dom.create("div","d-flex","gx-24-"+F,"mx-0","mb-2"),null!=L.label&&(L.label.classList.add("pl-3"),L.input.classList.add("pr-3"),_.appendChild(L.label)),_.appendChild(L.input),O.container=_,x.appendChild(_),O.note&&(L.input.children[1].innerHTML=O.note);n.appendChild(x)}this.container.appendChild(n),this.container.appendChild(this.toast),M=_regeneratorRuntime().mark(function t(){var n,e,i,r,a,o,s,l,d,c,u,p;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:"date"!=(n=N.fields[C]).input?t.next=7:(d=dom.find('input[name="'+n.name+'"]',N.container),new Datepicker(d,{format:"yyyy-mm-dd",language:"zh-CN",autohide:!0}),null!=n.value&&(dom.find("input[name='"+n.name+"']",N.container).value=moment(n.value).format("YYYY-MM-DD")),t.next=72);break;case 7:"datetime"!=n.input?t.next=14:($(N.container).find("input[name='"+n.name+"_date']").datetimepicker({format:"YYYY-MM-DD",language:"zh-CN",useCurrent:!1}),null!=n.value&&(dom.find("input[name='"+n.name+"_date']",N.container).value=moment(n.value).format("YYYY-MM-DD")),$(N.container).find("input[name='"+n.name+"_time']").datetimepicker({format:"HH:mm:00",locale:"zh_CN",useCurrent:!1}),null!=n.value&&(dom.find("input[name='"+n.name+"_time']",N.container).value=moment(n.value).format("HH:mm:00")),t.next=72);break;case 14:"time"!=n.input?t.next=19:($(N.container).find("input[name='"+n.name+"']").datetimepicker({format:"hh:mm:00",locale:"zh_CN",useCurrent:!1}),null!=n.value&&(dom.find("input[name='"+n.name+"']",N.container).value=moment(n.value).format("hh:mm:00")),t.next=72);break;case 19:if("select"!=n.input)t.next=29;else{if((e=n.options).validate=EditableForm.validate,Array.isArray(n.value)?e.selection=n.value[0][e.fields.value]:e.selection=n.value,(i=dom.find('select[name="'+n.name+'"]',N.container)).append(dom.element('<option data-placeholder="true"></option>')),e.values)for(r=0;r<e.values.length;r++)i.append(dom.element('<option value="'+e.values[r].value+'">'+e.values[r].text+"</option>"));new SlimSelect({select:i,placeholder:!0,settings:{allowDeselect:!0,showSearch:!1,placeholderText:"请选择…",contentPosition:"absolute"},events:{afterChange:function(t){}}}),t.next=72}break;case 29:if("cascade"!=n.input)t.next=40;else{for((a=n.options).validate=EditableForm.validate,o=0;o<a.levels.length;o++)s=a.levels[o],void 0!==h[s.name]&&(s.value=h[s.name]);a.required=n.required||!1,1==N.readonly&&(a.readonly=!0),1==n.readonly&&(a.readonly=!0),a.container=dom.find('div[data-cascade-name="'+n.name+'"]',N.container),new CascadeSelect(a),t.next=72}break;case 40:if("checklist"!=n.input)t.next=52;else{for(l in 1==N.readonly&&(n.options.readonly=!0),1==n.readonly&&(n.options.readonly=!0),n.options.name=n.name,N.params=N.params||{},n.options.data=n.options.data||{},N.params)n.options.data[l]=N.params[l];d=dom.find("div[data-checklist-name='"+n.name+"']",N.container),new Checklist(n.options).render(d,{selections:h[n.name]||[]}),n.container=d.parentElement.parentElement,t.next=72}break;case 52:if("checktree"!=n.input)t.next=64;else{for(c in n.options.name=n.name,n.options.readonly=N.readonly,N.params=N.params||{},n.options.data=n.options.data||{},N.params)n.options.data[c]=N.params[c];p=dom.find("div[data-checktree-name='"+n.name+"']",N.container),N[n.name]=new TreelikeList(n.options),N[n.name].render(p,n.value),n.container=p.parentElement.parentElement,t.next=72}break;case 64:if("fileupload"==n.input||"files"==n.input)return u=dom.find("div[data-fileupload-name='"+n.name+"']",N.container),t.next=68,new FileUpload(_objectSpread(_objectSpread({},n.options),{},{local:h[n.name]||[],name:n.name})).render(u);t.next=71;break;case 68:n.container=u.parentElement.parentElement,t.next=72;break;case 71:"imageupload"==n.input?new ImageUpload(n.options).render(dom.find("div[data-imageupload-name='"+n.name+"']",N.container)):"image"==n.input?new Medias(_objectSpread(_objectSpread({},n.options),{},{mediaType:"image",multiple:!1})).render(dom.find("div[data-medias-name='"+n.name+"']",N.container),n.value):"images"==n.input?new Medias(_objectSpread(_objectSpread({},n.options),{},{mediaType:"image"})).render(dom.find("div[data-medias-name='"+n.name+"']",N.container),n.value):"video"==n.input?new Medias(_objectSpread(_objectSpread({},n.options),{},{mediaType:"video",multiple:!1})).render(dom.find("div[data-medias-name='"+n.name+"']",N.container),n.value):"videos"==n.input?new Medias(_objectSpread(_objectSpread({},n.options),{},{mediaType:"video"})).render(dom.find("div[data-medias-name='"+n.name+"']",N.container),n.value):"longtext"==n.input?"javascript"===n.language&&(p=dom.find(containerId+" textarea[name='"+n.name+"']"),CodeMirror.fromTextArea(p,{mode:"javascript",lineNumbers:!0,height:420,background:"#565656"}).on("keyup",function(t,e){dom.find(" textarea[name='"+n.name+"']",this.container).innerText=t.getDoc().getValue()})):"avatar"==n.input?new Avatar({readonly:N.readonly,name:n.name}).render(dom.find("div[data-avatar-name='"+n.name+"']",N.container),n.value):"logo"==n.input&&new Logo({readonly:N.readonly,name:n.name}).render(dom.find("div[data-logo-name='"+n.name+"']",N.container),n.value);case 72:case"end":return t.stop()}},t)}),C=0;case 19:if(C<this.fields.length)return t.delegateYield(M(),"t0",21);t.next=24;break;case 21:C++,t.next=19;break;case 24:for((A=dom.create("div")).classList.add("buttons"),R=dom.create("div"),"page"!=this.mode?R.classList.add("float-right"):R.classList.add("row-button"),T=0;T<this.actions.length;T++)R.appendChild(this.createButton(this.actions[T])),R.append(" ");if((S=dom.create("button","btn","btn-sm","btn-close")).textContent="关闭",dom.bind(S,"click",function(){event.preventDefault(),event.stopPropagation();var t=dom.find("div[widget-id=right-bar]");null!=t&&(t.children[0].classList.add("out"),setTimeout(function(){t.remove()},300))}),!1===this.actionable)return t.abrupt("return");t.next=34;break;case 34:if(this.actionable&&"page"!=this.mode&&R.appendChild(S),(k=dom.create("button","btn","btn-sm","btn-save")).innerHTML=this.saveText,dom.bind(k,"click",function(t){t.preventDefault(),t.stopPropagation(),e.confirm?e.confirm():""!==e.confirmText?(t=e.confirmText,"function"==typeof e.confirmText&&(t=e.confirmText()),dialog.confirm(t,function(){e.save()})):e.save()}),null!=(P=dom.find("div[widget-id=right-bar-bottom]"))&&(P.innerHTML="",this.readonly||(R.appendChild(k),R.append(" ")),I=dom.create("div","full-width","b-a-0"),null!=dom.find(".right-bar")))if("none"!==P.parentElement.style.display){P.appendChild(k),q=_createForOfIteratorHelper(e.actions);try{for(q.s();!(Q=q.n()).done;)H=Q.value,P.appendChild(dom.element('<span style="display: inline-block;width: 12px;"></span>')),P.appendChild(e.createButton(H))}catch(t){q.e(t)}finally{q.f()}P.appendChild(dom.element('<span style="display: inline-block;width: 12px;"></span>')),P.appendChild(S)}else A.appendChild(R),I.appendChild(A),this.container.appendChild(I);this.originalPosition=this.container.getBoundingClientRect(),this.originalPositionTop=this.originalPosition.top,j=_createForOfIteratorHelper(e.fields);try{for(j.s();!(G=j.n()).done;)V=G.value,e.hideOrShowField(V)}catch(t){j.e(t)}finally{j.f()}this.onInit();case 45:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),EditableForm.prototype.fetch=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var n,i,r,a;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=e||{},(n=this).readOpt){t.next=5;break}return this.build(e),t.abrupt("return");case 5:if(this.readOpt.params)for(i in this.readOpt.params)e[i]=this.readOpt.params[i];if(this.readOpt.url||""!=this.readOpt.url){t.next=9;break}return this.build({}),t.abrupt("return");case 9:return t.next=11,xhr.promise({url:this.readOpt.url,data:e});case 11:if(r=(r=t.sent)||{},n.readOpt.asyncConvert)return t.next=16,n.readOpt.asyncConvert(r);t.next=17;break;case 16:r=t.sent;case 17:if(n.readOpt.convert&&(r=n.readOpt.convert(r)),n.oldValues=r,utils.isEmpty(r))n.build(e),n.readOpt.callback&&n.readOpt.callback(e);else{for(a in e)void 0===r[a]&&(r[a]=e[a]);n.build(r),n.readOpt.callback&&n.readOpt.callback(r)}case 20:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),EditableForm.prototype.read=function(t){var e=this;if(t=t||{},this.readOpt.params)for(var n in this.readOpt.params)t[n]=this.readOpt.params[n];xhr.post({url:this.readOpt.url,data:t,success:function(t){t.error?dialog.error(t.error.message):dom.formdata(e.container,t.data)}})},EditableForm.prototype.save=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(i){var r,e,n,a,o,s,l;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=(r=this).saveOpt.awaitConvert||!1,0<(n=Validation.validate($(this.containerId))).length)return r.error(utils.message(n)),t.abrupt("return");t.next=6;break;case 6:for(l in null!=(a=dom.find("button.btn-save",this.container))&&(a.innerHTML="<i class='fa fa-spinner fa-spin'></i>数据保存中……"),dom.disable(dom.find("button",this.container),"disabled",!0),o=dom.formdata(this.containerId),s=this.saveOpt.params||{},o)s[l]=o[l];if(this.saveOpt.convert){if(e)return t.next=16,this.saveOpt.convert(s);t.next=19}else t.next=22;break;case 16:s=t.sent,t.next=20;break;case 19:s=this.saveOpt.convert(s);case 20:t.next=26;break;case 22:if(this.saveOpt.asyncConvert)return t.next=25,this.saveOpt.asyncConvert(s);t.next=26;break;case 25:s=t.sent;case 26:xhr.post({url:this.saveOpt.url,usecase:this.saveOpt.usecase,data:s,success:function(t){if(null!=a&&(a.innerHTML=r.saveText),dom.enable("button",r.container),t.error)r.error(t.error.message);else{for(var e=document.querySelectorAll(" input[data-identifiable=true]",r.container),n=0;n<e.length;n++)e[n].value=t.data[e[n].name];r.saveOpt.callback&&r.saveOpt.callback(t.data),r.saveOpt.success&&r.saveOpt.success(t.data),!1!==i&&r.success(r.savePromptText||"数据保存成功！",function(){var t;!1!==r.saveOpt.autoClose&&null!=(t=dom.find("div[widget-id=right-bar]"))&&(t.children[0].classList.add("out"),setTimeout(function(){t.remove()},300))})}}});case 27:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),EditableForm.prototype.createInput=function(a,t){var n,i=this,o=this,e=(a.columnCount=a.columnCount||1,a.required||!1),t=24/(t=t||2),r=0,s=0,t=(24==t||12==t?(r=6,s=18):8==t?(r=3,s=5):6==t&&(r=2,s=4),dom.create("div","gx-24-"+this.formatGridCount(r),"col-form-label",e?"required":"norequired")),e=(t.innerText=a.title+"：",s+=(r+s)*(a.columnCount-1),dom.create("div","gx-24-"+this.formatGridCount(s))),l=dom.create("div","full-width","input-group"),r=dom.create("div","small","text-muted","pt-1"),d=(r.setAttribute("role","feedback"),e.appendChild(l),e.appendChild(r),null);if("code"==a.input){for(var c=a.fixed||[],u=0;u<c.length;u++){var p=dom.element('\n        <div class="input-group-prepend">\n          <span class="input-group-text">\n          </span>\n        </div>\n      ');p.querySelector("span").innerText=c[u],l.appendChild(p)}(d=dom.create("input","form-control")).disabled=this.readonly||a.readonly||!1,d.setAttribute("autocomplete","off"),d.setAttribute("name",a.name),d.setAttribute("label",a.title)}else if("select"==a.input)(d=dom.create("select","form-control")).style="-moz-appearance:none",d.disabled=this.readonly||a.readonly||!1,d.setAttribute("name",a.name),d.setAttribute("placeholder","请选择..."),d.setAttribute("label",a.title);else if("bool"==a.input){var d=dom.element('\n      <div class="d-flex full-width">\n        <label class="c-switch c-switch-label c-switch-pill c-switch-info mt-1" style="min-width: 48px;">\n          <input class="c-switch-input" value="T" name="" type="checkbox">\n          <span class="c-switch-slider" data-checked="是" data-unchecked="否"></span>\n        </label>\n        <select class="form-control ml-4">\n          <option value="-1">请选择</option>\n        </select>\n      </div>\n    '),s=dom.find("input",d),h=("T"!==a.value&&!0!==a.value||dom.find("input",d).setAttribute("checked",!1),!0===a.disabled&&(s.disabled=!0),s.setAttribute("label",a.title),dom.find("select",d));if(a.options){h.name=a.name+"$";for(var f=0;f<a.options.values.length;f++){var m=a.options.values[f];h.appendChild(dom.element('<option value="'+m.value+'" '+(a.value===m.value?"selected":"")+">"+m.text+"</option>"))}a.value&&"F"!==a.value?s.checked=!0:(s.checked=!1,h.disabled=!0),s.addEventListener("change",function(t){var e=dom.find("select",t.target.parentElement.parentElement);t.target.checked?e.disabled=!1:e.disabled=!0})}else h.remove();dom.find("input",d).setAttribute("name",a.name)}else if("radiotext"==a.input||"booltext"==a.input){var g=[],y="";a.values=a.values||[{value:"+",text:"正"},{value:"-",text:"负"}];for(var v=0;v<a.values.length;v++){var b=a.values[v];if(!b.input){y=b.value;break}}for(var w=!1,x=0;x<a.values.length;x++){var E=a.values[x],O=dom.element('\n        <div class="form-check form-check-inline">\n          <input name="" value="" type="radio"\n                 class="form-check-input radio color-primary is-outline">\n          <label class="form-check-label" for=""></label>\n        </div>\n      ');dom.find("input",O).name=a.name,a.value?a.value==E.value||E.value==y||w?a.value==E.value&&(w=dom.find("input",O).checked=!0):dom.find("input",O).checked=!0:E.checked&&(dom.find("input",O).checked=!0),!0===a.required&&(dom.find("input",O).setAttribute("required",!0),dom.find("input",O).setAttribute("data-required",a.title)),dom.find("input",O).value=E.value,dom.find("input",O).disabled=this.readonly||a.readonly||!1,dom.find("label",O).textContent=E.text,l.append(O),g.push(O)}for(var L=0;L<a.values.length;L++){var _,C=a.values[L];C.input?(dom.bind(g[L],"click",function(t){dom.find("input[type=text]",l).style.display=""}),(_=dom.element('<input type="text" class="form-control">')).name=C.input.name,_.placeholder=C.input.placeholder||"",_.style.display=a.value&&a.value!=y?"":"none",C.value!=a.value&&(_.value=a.value,_.value==y)&&(_.value=""),l.appendChild(_)):dom.bind(g[L],"click",function(t){dom.find("input[type=text]",l).style.display="none"})}}else if("radio"==a.input){l.classList.add("col-form-label"),a.values=a.values||[{value:"+",text:"正"},{value:"-",text:"负"}];for(var A=0;A<a.values.length;A++)!function(r){var t=a.values[r],e=dom.element('\n        <div class="form-check form-check-inline">\n          <input name="" value="" type="radio"\n                 class="form-check-input radio color-primary is-outline">\n          <label class="form-check-label" for=""></label>\n        </div>\n      ');dom.find("input",e).name=a.name,(a.value==t.value||t.checked&&!a.value)&&(dom.find("input",e).checked=!0),dom.find("input",e).value=t.value,dom.find("input",e).disabled=i.readonly||a.readonly||!1,dom.find("label",e).textContent=t.text,!0===a.required&&(dom.find("input",e).setAttribute("required",!0),dom.find("input",e).setAttribute("data-required",a.title)),l.append(e),e.onchange=function(t){a.onInput&&a.onInput(a.values[r].value);var e,n=_createForOfIteratorHelper(o.fields);try{for(n.s();!(e=n.n()).done;){var i=e.value;o.hideOrShowField(i)}}catch(t){n.e(t)}finally{n.f()}}}(A)}else if("longtext"==a.input)d=dom.create("textarea","form-control"),a.style=a.style||"",d.style=a.style,""===a.style&&(d.rows=4),d.setAttribute("name",a.name),d.setAttribute("placeholder","请输入"),d.innerHTML=a.value||"",!0!==this.readonly&&!0!==a.readonly||d.setAttribute("disabled",!0);else{if("selecttext"==a.input)return(r=dom.create("div","full-width","position-relative")).style.height="120px",r.style.overflow="hidden",d=dom.create("textarea","form-control","full-width"),a.style=a.style||"",d.style=a.style,d.style.height="120px",d.style.resize="none",(s=dom.create("div")).style.position="absolute",s.style.bottom="0",s.style.right="0",s.style.background="transparent",s.style.borderWidth="0px 0px 48px 48px",s.style.borderStyle="solid",s.style.borderColor="transparent transparent rgba(0, 0, 0, 0.3)",d.setAttribute("name",a.name),d.setAttribute("placeholder","请输入"),d.innerHTML=a.value||"",r.appendChild(d),r.appendChild(s),(s=dom.create("a","btn-link","font-11","text-light")).innerText="选择",s.style.position="absolute",s.style.bottom="-2px",s.style.right="-2px",dom.bind(s,"click",function(t){a.onSelect&&a.onSelect(d)}),!0===this.readonly||!0===a.readonly?d.setAttribute("disabled",!0):r.appendChild(s),l.appendChild(r),{label:t,input:l};if("cascade"==a.input)l.style.overflow="hidden",d=dom.create("div","form-control"),this.readonly&&(d.style.backgroundColor="rgb(240, 243, 245)"),d.setAttribute("data-cascade-name",a.name);else if("checktree"==a.input)(d=dom.create("div","full-width")).setAttribute("data-checktree-name",a.name),d.setAttribute("id","checktree_"+a.name);else if("checklist"==a.input)(d=dom.create("div","full-width")).setAttribute("data-checklist-name",a.name);else if("fileupload"==a.input)(d=dom.create("div","full-width")).setAttribute("data-fileupload-name",a.name);else if("imageupload"==a.input)(d=dom.create("div","full-width")).setAttribute("data-imageupload-name",a.name);else if("image"==a.input)(d=dom.create("div","full-width","row","mx-0")).setAttribute("data-medias-name",a.name);else if("images"==a.input)(d=dom.create("div","full-width","row","mx-0")).setAttribute("data-medias-name",a.name);else if("video"==a.input)(d=dom.create("div","full-width","row","mx-0")).setAttribute("data-medias-name",a.name);else if("videos"==a.input)(d=dom.create("div","full-width","row","mx-0")).setAttribute("data-medias-name",a.name);else{if("avatar"==a.input)return(d=dom.create("div","full-width","avatar-img")).setAttribute("data-avatar-name",a.name),l.classList.add("gx-24-24"),l.appendChild(d),{label:null,input:l};if("logo"==a.input)return(d=dom.create("div","full-width")).setAttribute("data-logo-name",a.name),l.classList.add("gx-24-24"),l.appendChild(d),{label:null,input:l};if("datetime"==a.input)return s=dom.element('\n      <div class="input-group-prepend">\n        <span class="input-group-text">\n          <i class="far fa-calendar-alt"></i>\n        </span>\n      </div>\n    '),(r=dom.create("input","form-control")).disabled=this.readonly||a.readonly||!1,r.setAttribute("name",a.name+"_date"),r.setAttribute("placeholder","请选择..."),r.setAttribute("autocomplete","off"),R=dom.element('\n      <div class="input-group-prepend">\n        <span class="input-group-text">\n          <i class="far fa-clock"></i>\n        </span>\n      </div>\n    '),(I=dom.create("input","form-control")).disabled=this.readonly||a.readonly||!1,I.setAttribute("name",a.name+"_time"),I.setAttribute("autocomplete","off"),l.appendChild(s),l.appendChild(r),l.appendChild(R),l.appendChild(I),{label:t,input:l};"tags"==a.input?((d=dom.create("input","full-width")).name=a.name,d.value=a.value,d.disabled=this.readonly||a.readonly||!1):"custom"==a.input?((d=dom.create("input","form-control")).name=a.name,d.disabled=!0):((d=dom.create("input","form-control")).disabled=this.readonly||a.readonly||!1,d.setAttribute("name",a.name),d.setAttribute("placeholder","请输入"),d.setAttribute("autocomplete","off"),a.value&&(d.value=a.value))}}null!=d&&l.appendChild(d),a.domain&&d.setAttribute("data-domain-type",a.domain),"tags"==a.input?(d.setAttribute("placeholder","请输入"),new Tagify(d)):"date"==a.input?(d.setAttribute("data-domain-type","date"),d.setAttribute("placeholder","请选择...")):0==a.input.indexOf("number")?(d.setAttribute("data-domain-type",a.input),d.setAttribute("placeholder","请输入")):"file"==a.input&&(d.setAttribute("readonly",!0),(n=dom.create("input")).setAttribute("type","file"),n.style.display="none",(s=dom.element('<span class="input-group-text pointer"><i class="fas fa-upload text-primary"></i></span>')).addEventListener("click",function(){n.click()}),n.addEventListener("change",function(t){t.preventDefault(),t.stopPropagation(),d.value=n.files[0].name;var t=d.value.lastIndexOf("."),e="";-1!=t&&(e=d.value.substring(d.value.lastIndexOf(".")+1)),xhr.upload({url:"/api/v3/common/upload",params:a.params,file:n.files[0],success:function(t){t=t.data;t&&(d.setAttribute("data-file-type",n.files[0].type),d.setAttribute("data-file-size",n.files[0].size),d.setAttribute("data-file-path",t.filepath),d.setAttribute("data-file-ext",e),d.setAttribute("data-file-name",t.filename),d.setAttribute("data-web-path",t.webpath))}}),EditableForm.validate(d)}),l.appendChild(n),this.readonly||l.appendChild(s)),a.create&&(r=dom.element('\n      <span class="input-group-text">\n        <i class="fas fa-plus-square pointer text-success"></i>\n      </span>\n    '),"custom"!=a.input&&"select"!=a.input||(R=a.name,a.widgetCustom=dom.element('\n        <div widget-id="widgetCustom_'.concat(R,'" class="full-width"></div>\n      ')),a.create(r,a.widgetCustom,a),!0!==a.readonly&&!0!==this.readonly))&&l.appendChild(r);var R,T,S,k,P,I=dom.element('\n    <span class="input-group-text"></span>\n  '),s=(a.unit&&(dom.find("span",I).innerHTML=a.unit,l.appendChild(I)),dom.element('\n    <span class="input-group-text width-36 icon-error"></span>\n  '));return a.required&&null!=d?(d.setAttribute("data-required",a.title),s.innerHTML=ICON_REQUIRED):s.innerHTML=ICON_GENERAL,a.tooltip&&(s.classList.add("pointer"),R=dom.element('<div class="popup hidden">  <div class="popup-arrow"></div>  <div class="popup-body">'+a.tooltip+"</div></div>"),s.appendChild(R),dom.bind(s,"click",function(){this.offsetLeft;var t=this.offsetTop,e=parseInt(this.clientHeight),n=dom.find("div.popup",this);n.style.right="0",n.style.top=t-e/2+"px",n.classList.remove("hidden"),n.classList.add("show"),setTimeout(function(t){n.classList.remove("show"),n.classList.add("hidden")},2e3)})),this.readonly||"bool"===a.input||"radio"===a.input||"checklist"===a.input||"longtext"===a.input||"checktree"===a.input||"fileupload"===a.input||"imageupload"===a.input||"image"===a.input||"images"===a.input||"video"===a.input||"videos"===a.input||"files"===a.input||"tags"===a.input||l.append(s),null!=d&&dom.bind(d,"input",function(t){a.onInput&&a.onInput(t),EditableForm.validate(this)}),"date"!=a.input&&"text"!=a.input&&0!=a.input.indexOf("number")&&"file"!=a.input||(r=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),T=r.get,S=r.set,Object.defineProperty(d,"value",{get:function(){return T.call(this)},set:function(t){return S.call(this,t),EditableForm.validate(this),t}}),d.value=a.value),"select"==a.input&&(I=Object.getOwnPropertyDescriptor(HTMLSelectElement.prototype,"selectedIndex"),k=I.get,P=I.set,Object.defineProperty(d,"selectedIndex",{get:function(){return k.call(this)},set:function(t){return P.call(this,t),EditableForm.validate(this),t}}),d.value=a.value),0==a.input.indexOf("number")&&["input","keydown","keyup","mousedown","mouseup","select","contextmenu","drop"].forEach(function(t){d.addEventListener(t,function(t){var e=this.getAttribute("data-domain-type");Validation.getDomainValidator(new ValidationModel(e)).test(this.value)!=REQUIRED_ERROR?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value="",EditableForm.validate(this)})}),a.widgetCustom&&l.appendChild(a.widgetCustom),{label:t,input:e}},EditableForm.prototype.createButton=function(e){var n=this,t=dom.create("button","btn","btn-sm");if(e.classes)for(var i=0;i<e.classes.length;i++)t.classList.add(e.classes[i]);return e.style&&(t.style=e.style),t.innerHTML=e.text,e.onClicked&&(t.onclick=function(t){e.confirmText?dialog.confirm(e.confirmText,function(){e.onClicked(dom.formdata(n.container))}):e.onClicked(dom.formdata(n.container))}),t},EditableForm.prototype.error=function(t){t=(t=t||"出现系统错误！").replaceAll("\n","<br>"),this.toast.style.zIndex=11e3,this.toast.classList.remove("bg-success","hidden"),this.toast.classList.add("bg-danger");var e=this.container.getBoundingClientRect().top-this.originalPositionTop;this.toast.style.top=10-e+"px",dom.find(".toast-body",this.toast).innerHTML=t,dom.find("strong",this.toast).innerText="错误",this.toast.classList.add("show","in")},EditableForm.prototype.success=function(t,e){var n=this;this.toast.style.zIndex=11e3,this.toast.classList.remove("bg-danger","hidden"),this.toast.style.backgroundColor="var(--color-success)";var i=this.container.getBoundingClientRect().top-this.originalPositionTop;this.toast.style.top=10-i+"px",dom.find(".toast-body",this.toast).innerHTML=t,dom.find("strong",this.toast).innerText="成功",this.toast.classList.add("show","in"),setTimeout(function(){dom.find("button",n.toast).click(),e&&e()},1e3)},EditableForm.prototype.hideSidebar=function(t,e){var n=dom.find("div[widget-id=right-bar]");null!=n&&(n.children[0].classList.add("out"),setTimeout(function(){n.remove()},300))},EditableForm.validate=function(t){if(null!=(t="OPTION"==t.tagName?t.parentElement:t)){var e=dom.find("div span.icon-error",t.parentElement);if(null!=e){var n=t.getAttribute("data-required"),n=null!=n&&""!==n;if("SELECT"==t.tagName)-1==t.selectedIndex?e.innerHTML=n?ICON_REQUIRED:ICON_GENERAL:e.innerHTML=ICON_CORRECT;else if("DIV"==t.tagName){for(var i=t.querySelectorAll("a[data-cascade-name]"),r=[],a=0;a<i.length;a++){var o=i[a].getAttribute("data-cascade-value");null!=o&&"-1"!=o&&""!=o&&r.push(o)}r.length==i.length?e.innerHTML=ICON_CORRECT:e.innerHTML=0==r.length?n?ICON_REQUIRED:ICON_GENERAL:ICON_ERROR}else""==t.value.trim()?e.innerHTML=n?ICON_REQUIRED:ICON_GENERAL:null==(n=t.getAttribute("data-domain-type"))||""==n||(n=Validation.getDomainValidator(new ValidationModel(n)).test(t.value))==NO_ERRORS?e.innerHTML=ICON_CORRECT:n==FORMAT_ERROR&&(e.innerHTML=ICON_ERROR)}}},EditableForm.prototype.setInputValue=function(t,e){var n,i,r=null,a=_createForOfIteratorHelper(this.fields);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o.name===t){r=o;break}}}catch(t){a.e(t)}finally{a.f()}null!=r&&"bool"===r.input&&(i=dom.find('input[name="'.concat(t,'"]'),this.container),"T"===e&&!i.checked||"F"===e&&i.checked)&&i.click()},EditableForm.prototype.getInputValue=function(t){var e,n=null,i=_createForOfIteratorHelper(this.fields);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(r.name===t){n=r;break}}}catch(t){i.e(t)}finally{i.f()}return null!=n&&"bool"===n.input?dom.find('input[name="'.concat(t,'"]'),this.container).checked?"T":"F":null},EditableForm.prototype.input=function(t){var e=t.name,n=t.value,t=t.text,e=this.controls[e];e&&(t=new Option(t,n,!1,!0),e.append(t).trigger("change"))},EditableForm.prototype.formatGridCount=function(t){return t<10?"0"+t:""+t},EditableForm.prototype.setVariables=function(t){for(var e in t)this.variableListeners[e]&&this.variableListeners[e](t[e])},EditableForm.prototype.getField=function(t){var e,n=_createForOfIteratorHelper(this.fields);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.name===t)return i}}catch(t){n.e(t)}finally{n.f()}return{}},EditableForm.prototype.hideOrShowField=function(t){var e=dom.formdata(this.container);"function"==typeof t.visible&&(!0===t.visible(e)?(!0===t.required&&this.container.querySelector('[name="'+t.name+'"]').setAttribute("data-required",t.title),t.container.style.display=""):(!0===t.required&&this.container.querySelector('[name="'+t.name+'"]').setAttribute("data-required",""),t.container.style.setProperty("display","none","important")))},EditableForm.prototype.hideFields=function(t){function e(t){(t=dom.find('[name="'+t+'"]',n.container)).style.display="none",t.parentElement.parentElement.style.setProperty("display","none","important")}var n=this;if(Array.isArray(t)){var i,r=_createForOfIteratorHelper(t);try{for(r.s();!(i=r.n()).done;)e(i.value)}catch(t){r.e(t)}finally{r.f()}}else e(t)},EditableForm.prototype.showFields=function(t){function e(t){(t=dom.find('[name="'+t+'"]',n.container)).style.display="",t.parentElement.parentElement.style.display=""}var n=this;if(Array.isArray(t)){var i,r=_createForOfIteratorHelper(t);try{for(r.s();!(i=r.n()).done;)e(i.value)}catch(t){r.e(t)}finally{r.f()}}else e(t)},EditableForm.prototype.compare=function(t){for(var e=t||this.oldValues||{},n=dom.formdata(this.containerId),i=[],r=0;r<this.fields.length;r++){var a=this.fields[r],o=e[a.name],s=e[a.name],l=n[a.name],d=n[a.name];if("date"==a.input)s=moment(o).format("YYYY-MM-DD");else if("select"==a.input&&a.options.values){var c,u=_createForOfIteratorHelper(a.options.values);try{for(u.s();!(c=u.n()).done;){var p=c.value;p.value===o&&(s=p.text),p.value===l&&(d=p.text)}}catch(t){u.e(t)}finally{u.f()}}l=l?l.toString():"",o=o?o.toString():"",d=d?d.toString():"",s=s?s.toString():"",l!==o&&i.push({name:a.name,oldValue:o,oldText:s,newValue:l,newText:d})}return i},EditableForm.prototype.getData=function(){var t,o=this,s=dom.formdata(this.container);for(t in s)this.assignValue2Name(s,t,s[t]);for(var l=0;l<this.fields.length;l++)(function(){var t=o.fields[l];if("images"===t.input){var e=[];dom.find('div[data-medias-name="'+t.name+'"]',o.container).querySelectorAll("img").forEach(function(t){t=t.parentElement,t=dom.model(t);e.push(_objectSpread({},t))}),o.assignValue2Name(s,t.name,e)}else if("image"===t.input){var n=dom.find('div[data-medias-name="'+t.name+'"]',o.container).querySelector("img");if(null==n)return;n=dom.model(n.parentElement);o.assignValue2Name(s,t.name,n)}else if("video"===t.input){n=dom.find('div[data-medias-name="'+t.name+'"]',o.container).querySelector("img");if(null==n)return;n=dom.model(n.parentElement);o.assignValue2Name(s,t.name,n)}else if("videos"!==t.input&&"tags"===t.input){for(var i=dom.find('input[name="'+t.name+'"]',o.container).parentElement.querySelectorAll("tag"),r="",a=0;a<i.length;a++)""!=r&&(r+=","),r+=i[a].innerText;s[t.name]=r}})();return s},EditableForm.prototype.setData=function(t){},EditableForm.prototype.assignValue2Name=function(t,e,n){var i,r=e.indexOf(".");-1==r?t[e]=n:(t[i=e.substring(0,r)]||(t[i]={}),this.assignValue2Name(t[i],e.substring(r+1),n),delete t[e])};var FILE_TYPE_EXCEL='<i class="far fa-file-excel"></i>',FILE_TYPE_WORD='<i class="far fa-file-word"></i>',FILE_TYPE_POWERPOINT='<i class="far fa-file-powerpoint"></i>',FILE_TYPE_PDF='<i class="far fa-file-pdf"></i>',FILE_TYPE_VIDEO='<i class="far fa-file-video"></i>',FILE_TYPE_AUDIO='<i class="far fa-file-audio"></i>',FILE_TYPE_IMAGE='<i class="far fa-file-image"></i>',FILE_TYPE_ARCHIVE='<i class="far fa-file-archive"></i>',FILE_TYPE_FILE='<i class="far fa-file-alt"></i>';function FileUpload(t){this.name=t.name,this.fetchUrl=t.url.fetch,this.usecase=t.usecase,this.uploadUrl=t.url.upload||"/api/v3/common/upload",this.local=t.local,this.params=t.params,this.onRemove=t.onRemove||function(t){}}function ImageUpload(t){this.fetchUrl=t.url.fetch,this.usecase=t.usecase,this.uploadUrl=t.url.upload,this.local=t.local,this.params=t.params,this.capture=t.capture}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function Medias(t){this.params=t.params||{},this.readonly=!0===t.readonly,this.width=t.width||"80",this.height=this.width,this.multiple=!1!==t.multiple,this.url=t.url||"/api/v3/common/upload",this.fetch=t.fetch,this.onRemove=t.onRemove,this.mediaType=t.mediaType||"image"}function MobileFrame(t){this.url=t.url,this.width=t.width}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function PaginationGrid(t){var e=this;"object"===_typeof(t.url)?(this.url=t.url.root,this.urlChild=t.url.child):this.url=t.url,"object"===_typeof(t.usecase)?(this.usecase=t.usecase.root,this.usecaseChild=t.usecase.child):this.usecase=t.usecase,this.onRender=t.onRender,this.filters=t.params||t.filters||{},this.favourite=t.favourite||!1,this.start=t.start||0,this.limit=t.limit||5,this.colspan=t.colspan||8,this.borderless=t.borderless||!1,t.filter&&(t.filter.query={callback:function(t){e.go(1,t)}},(t.filter.table=this).queryFilter=new QueryFilter(t.filter)),t.query&&(this.widgetQuery=new QueryLayout(t.query))}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function PaginationTable(t){var n=this;if(this.url=t.url,this.usecase=t.usecase,this.refreshable=!1!==t.refreshable,void 0!==t.resultFilters&&(this.resultFilters=t.resultFilters),this.local=t.local,void 0!==t.local&&(this.local={},this.local.total=t.local.length,this.local.data=t.local),this.limit=t.limit||15,this.cache=t.cache||"server",this.style=t.style||"full",this.headless=t.headless||!1,void 0!==t.hoverable?this.hoverable=t.hoverable:this.hoverable=!0,this.filters={},t.filters)for(var e in t.filters)this.filters[e]=t.filters[e];if(t.params)for(var i in t.params)this.filters[i]=t.params[i];this.showLoading=t.showLoading||!1,this.width=t.width,this.height=t.height,this.tbodyHeight=t.tbodyHeight,this.queryId=t.queryId||null,this.boundedQuery=t.boundedQuery||null,this.groupField=t.groupField,this.totalFields=t.totalFields||[],this.showDataRowLength=t.showDataRowLength||!1,this.containerId=t.containerId,void 0===t.useCookie?this.useCookie=!1:this.useCookie=t.useCookie,this.afterLoad=t.afterLoad||function(t){},this.columns=t.columns||[],this.allcolumns=0,this.columnMatrix=[];for(var r=0,a=0;a<this.columns.length;++a){var o=this.columns[a],r=Math.max(r,o.rowspan||1);void 0!==o.colspan?this.allcolumns+=o.colspan:this.allcolumns++}this.mappingColumns=[],this.headRowCount=r,this.start=0,this.rollbackStart=0,this.total=0,this.table=null,this.result=null,this.showTop=!1!==t.showTop;for(var s=0;s<r;++s)this.columnMatrix.push([]);this.buildMatrix(this.columns,0),this.buildMappingColumns(this.columns),t.filter&&(t.filter.query={callback:function(t){n.go(1,t)}},this.widgetQuery=new QueryLayout(t.filter),this.optsFilter=t.filter),t.query&&(this.widgetQuery=new QueryLayout(t.query)),t.filter2&&(this.optsFilter2=t.filter2),t.excess&&(this.widgetExcess=t.excess),t.sort&&(t.sort.local=t.sort.fields,t.sort.create=function(t,e){e=dom.element('\n        <div class="full-width" style="margin-top: -8px; margin-bottom: -8px">\n          <span class="position-relative" style="top: 8px;">'.concat(e.title,'</span>\n          <a data-role="desc" class="btn text-gray float-right" data-model-name="').concat(e.name,'">\n            <i class="fas fa-sort-amount-up"></i>\n          </a>\n          <a data-role="asc" class="btn text-gray float-right" data-model-name="').concat(e.name,'">\n            <i class="fas fa-sort-amount-down-alt"></i>\n          </a>\n        </div>\n      '));return dom.bind(dom.find("a[data-role=asc]",e),"click",function(){var t=dom.model(this);n.request({_order_by:t.name+" asc"})}),dom.bind(dom.find("a[data-role=desc]",e),"click",function(){var t=dom.model(this);n.request({_order_by:t.name+" desc"})}),e},this.widgetSort=new ListView(t.sort)),this.group=t.group}FileUpload.prototype.fetch=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var n;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.fetchUrl){t.next=4;break}return this.local=[],this.render(e),t.abrupt("return");case 4:return n=this,t.next=7,xhr.promise({url:this.fetchUrl,params:n.params});case 7:n.local=t.sent,n.render(e);case 9:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),FileUpload.prototype.append=function(t){var e,n,i,r,a,o=this;t&&(t.filepath&&(t.filepath=t.filepath.replace("/www/","")),t.filepath,e=dom.find("ul",this.container),(n=dom.create("li","list-group-item","list-group-item-input")).style.lineHeight="32px",r=(i=dom.templatize('\n    <div class="full-width d-flex">\n      <a class="btn-link">\n        <i class="far fa-file-alt mr-2"></i>\n      </a>\n      <span class="text-info" style="padding-bottom: 8px;">{{filename}}</span>\n      <a class="btn-link ml-auto pointer">\n        <i class="fas fa-trash-alt text-danger"></i>\n      </a>\n    </div>\n  ',t)).children[1],a=i.children[2],n.appendChild(i),r.setAttribute("data-img-url",t.filepath),r.setAttribute("data-file-path",t.filepath),r.setAttribute("data-file-name",t.filename),r.setAttribute("data-file-type",t.type),r.setAttribute("data-file-size",t.size),r.setAttribute("data-file-ext",t.extension),t.storedFileId&&r.setAttribute("data-file-id",t.storedFileId),n.setAttribute("data-file-path",t.filepath),n.setAttribute("data-file-name",t.filename),n.setAttribute("data-file-type",t.type),n.setAttribute("data-file-size",t.size),n.setAttribute("data-file-ext",t.extension),t.storedFileId&&n.setAttribute("data-file-id",t.storedFileId),e.appendChild(n),dom.bind(a,"click",function(t){var e=dom.ancestor(t.target,"li"),n=e.getAttribute("data-file-id");dialog.confirm("确定删除此附件？",function(){e.remove(),o.onRemove&&o.onRemove(n)})}))},FileUpload.prototype.render=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var i,n,r,a,o,s,l;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===(i=this).local)return t.next=4,this.fetch(e);t.next=5;break;case 4:return t.abrupt("return");case 5:for(this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="",n=dom.create("div","input-group","full-width"),(r=dom.create("input","form-control")).setAttribute("name",this.name),r.setAttribute("readonly",!0),(a=dom.create("input")).setAttribute("type","file"),a.style.display="none",(o=dom.element('\n    <div class="input-group-append">\n      <span class="input-group-text pointer">\n        <i class="fas fa-upload text-primary"></i>\n      </span>\n    </div>')).addEventListener("click",function(){a.click()}),a.addEventListener("change",function(t){var n=this;t.preventDefault(),t.stopPropagation(),r.value=a.files[0].name,xhr.upload({url:i.uploadUrl,params:i.params,file:this.files[0],success:function(t){t=t.data;t.filename=n.files[0].name;var e="";-1!=t.filename.lastIndexOf(".")&&(e=r.value.substring(r.value.lastIndexOf(".")+1)),t.filename=t.filename.replaceAll("/www",""),t.type=n.files[0].type,t.size=n.files[0].size,t.extension=e,i.append(t)}})}),n.appendChild(a),n.appendChild(r),n.appendChild(o),this.container.append(n),o=dom.create("ul","list-group","full-width","overflow-hidden"),this.container.appendChild(o),s=0;s<this.local.length;s++)l=this.local[s],this.append(l);case 24:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),ImageUpload.prototype.fetch=function(e){var n=this;xhr.post({url:this.fetchUrl,data:this.params||{},success:function(t){t.error?n.local=[]:n.local=t.data,n.render(e)},error:function(){n.local=[],n.render(e)}})},ImageUpload.prototype.append=function(t){var e,n=dom.find("ul",this.container),i=dom.create("li","list-group-item","p-0"),r=(i.style.height="100px",i.style.width="calc(98%/ 3)",i.style.flexGrow="0",dom.create("a","btn","btn-link","text-info","p-0")),n=(i.appendChild(r),n.appendChild(i),i.getBoundingClientRect()),i=null;(i=t.filepath?(e=t.filepath.replace("/www/",""),r.setAttribute("data-img-url",e),dom.element('<img widget-id="widget-'+e+'" src="'+e+'">')):dom.element('<img src="'+t.imgdata+'">')).setAttribute("width",n.width+"px"),i.setAttribute("height",n.height+"px"),r.appendChild(i),dom.bind(r,"click",function(){var t=r.getAttribute("data-img-url"),e=dom.find(".viewer-container"),e=(null!=e&&e.remove(),dom.find('img[widget-id="widget-'+t+'"]'));new Viewer(e).show()})},ImageUpload.prototype.render=function(t){var i=this;if(void 0===this.local)this.fetch(t);else{this.container="string"==typeof t?document.querySelector(t):t,this.container.innerHTML="";var t=dom.create("div","input-group","full-width"),e=dom.create("input","form-control"),n=(e.setAttribute("name",this.name),e.setAttribute("readonly",!0),dom.create("input")),r=(n.setAttribute("type","file"),n.style.display="none",dom.element('\n    <div class="input-group-append">\n      <span class="input-group-text pointer">\n        <i class="fas fa-upload text-primary"></i>\n      </span>\n      <span class="input-group-text pointer">\n        <i class="fas fa-camera text-primary"></i>\n      </span>\n    </div>')),r=(this.capture?r.children[1].addEventListener("click",function(){i.capture(function(t,e){var n={};utils.clone(i.params,n),n.filedata=e,n.fileext=t.substring(t.lastIndexOf(".")+1),xhr.post({url:"/api/v3/common/image",params:n,success:function(t){t=t.data;t.filename=t.filepath.substring(t.filepath.lastIndexOf("/")+1),i.append(t)}})})}):r.children[1].remove(),r.children[0].addEventListener("click",function(){n.click()}),n.addEventListener("change",function(t){t.preventDefault(),t.stopPropagation(),e.value=n.files[0].name,xhr.upload({url:i.uploadUrl,params:i.params,file:this.files[0],success:function(t){t=t.data;t.filename=t.filepath.substring(t.filepath.lastIndexOf("/")+1),i.append(t)}})}),t.appendChild(n),t.appendChild(e),t.appendChild(r),this.container.append(t),dom.create("ul","list-group","full-width","overflow-hidden"));r.style.display="flex",r.style.flexWrap="wrap",r.style.flexDirection="row",this.container.appendChild(r);for(var a=0;a<this.local.length;a++){var o=this.local[a];this.append(o)}}},Medias.prototype.render=function(t,e){if(this.value=e,this.container=dom.find(t),Array.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];this.appendMedia(i)}else if(e&&(this.appendMedia(e),!1===this.multiple))return;!1===this.readonly&&(t=this.createPlusElement(),this.container.appendChild(t))},Medias.prototype.createPlusElement=function(){var e=this,n=("image"==this.mediaType?this.plus=dom.templatize('\n      <div class="d-flex align-items-center justify-content-center pointer" \n                  style="height: {{width}}px; width: {{width}}px; border: 1px solid #eee;">\n        <i class="fas fa-plus" style="color: #bbb;"></i>\n        <input type="file" accept=".jpg, .png, .jpeg, .gif, .bmp, .tif, .tiff|image/*"\n               style="display: none">\n      </div>\n    ',this):this.plus=dom.templatize('\n      <div class="d-flex align-items-center justify-content-center pointer" \n                  style="height: {{width}}px; width: {{width}}px; border: 1px solid #eee;">\n        <i class="fas fa-plus" style="color: #bbb;"></i>\n        <input type="file" accept="video/mp4,video/x-m4v,video/*" style="display: none">\n      </div>\n    ',this),dom.find("input",this.plus));return n.onchange=function(t){n.files&&0!=n.files.length&&(e.url?e.readImageAsRemote(n.files[0]):e.readImageAsLocal(n.files[0]))},dom.bind(this.plus,"click",function(t){n.click()}),this.plus},Medias.prototype.readImageAsLocal=function(t){var e=this,n=t,i=new FileReader;i.onload=function(){"image"===e.mediaType?e.appendImage({url:i.result}):e.appendVideoImage(t,2)},i.readAsDataURL(n)},Medias.prototype.readImageAsRemote=function(t){var e=this;xhr.upload({url:this.url,params:_objectSpread(_objectSpread({},this.params),{},{file:t}),success:function(t){t.data&&(t=t.data),"image"===e.mediaType?e.appendImage({imagePath:t.webpath}):e.appendVideoImage({videoPath:t.webpath},2)}})},Medias.prototype.appendMedia=function(t){"image"===this.mediaType?this.appendImage(t="string"==typeof t?{imagePath:t}:t):this.appendVideoImage(t="string"==typeof t?{videoPath:t}:t,2)},Medias.prototype.appendImage=function(e){var n=this,t=dom.templatize('\n    <div class="d-flex align-items-center justify-content-center pointer position-relative" \n         style="height: {{width}}px; width: {{width}}px; border: 1px solid #eee;">\n      <img src="{{imagePath}}" style="width: 100%; height: 100%;">\n      <a widget-media-id="{{id}}" class="btn-link position-absolute" style="bottom: 0; right: 4px;">\n        <i class="fas fa-trash-alt text-danger"></i>\n      </a>\n    </div>\n  ',_objectSpread(_objectSpread({},e),{},{width:this.width})),i=(dom.model(t,e),dom.find("img",t)),r=(dom.bind(i,"click",function(t){t.stopPropagation(),t.preventDefault(),"image"==n.mediaType?new Viewer(i,{toolbar:!1,navbar:!1,tooltip:!1,title:!1}).show():"video"==n.mediaType&&n.play(e.videoPath)}),dom.find("a",t));!1===this.readonly?(this.container.insertBefore(t,this.plus),dom.bind(r,"click",function(t){var e=dom.model(r.parentElement);t.preventDefault(),t.stopPropagation(),r.parentElement.remove(),!1===n.multiple&&(t=n.createPlusElement(),n.container.appendChild(t)),n.onRemove&&n.onRemove(e)})):(r.remove(),this.container.appendChild(t)),!1===this.multiple&&this.plus&&this.plus.remove()},Medias.prototype.appendVideoImage=function(a,t){var o=this,s=document.createElement("canvas"),l=(s.style.width=this.width+"px",s.style.height=this.width+"px",s.width=this.width*window.devicePixelRatio,s.height=this.width*window.devicePixelRatio,s.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),document.createElement("video"));l.onloadedmetadata=function(){"function"==typeof t&&(t=t(l.duration)),l.currentTime=Math.min(Math.max(0,(t<0?l.duration:0)+t),l.duration)},l.onseeked=function(t){var e=l.videoHeight,n=l.videoWidth,i=e/n,r=s.getContext("2d");r.fillStyle="black",r.fillRect(0,0,s.width,s.height),i<1?r.drawImage(l,0,(o.height-o.width*i)/2,o.width,o.width*i):r.drawImage(l,(o.height-o.width*(i=n/e))/2,0,o.width*i,o.height),o.appendImage({imagePath:s.toDataURL("image/png"),videoPath:a.videoPath}),s.remove(),l.remove()},l.onerror=function(t){},l.src=a.videoPath},Medias.prototype.play=function(t){ajax.shade({url:"html/misc/video/player.html?path="+t,containerId:document.body,success:function(){pagePlayer.show({path:t})}})},MobileFrame.prototype.render=function(t){this.container=dom.find(t);var t=this.container.getBoundingClientRect().height/900,e=this.width,n=0,t=(e?n=e/(462/900):e=(n=900*t)*(462/900),this.width=e,this.scaleRatio=this.width/462,this.safeAreaTopLeftX=15*this.scaleRatio,this.safeAreaTopLeftY=60*this.scaleRatio,this.safeAreaTopRightX=446*this.scaleRatio,this.safeAreaTopRightY=60*this.scaleRatio,this.safeAreaBotLeftX=15*this.scaleRatio,this.safeAreaBotLeftY=836*this.scaleRatio,this.safeAreaBotRightX=446*this.scaleRatio,this.safeAreaBotRightY=836*this.scaleRatio,this.safeAreaWidth=this.safeAreaTopRightX-this.safeAreaTopLeftX,this.safeAreaHeight=this.safeAreaBotLeftY-this.safeAreaTopLeftY,this.topBarLeftX=60*this.scaleRatio,this.topBarLeftY=13*this.scaleRatio,this.topBarRightX=398*this.scaleRatio,this.topBarRightY=13*this.scaleRatio,this.botBarLeftX=60*this.scaleRatio,this.botBarLeftY=890*this.scaleRatio,this.botBarRightX=398*this.scaleRatio,this.botBarRightY=890*this.scaleRatio,this.safeAreaWidth=this.safeAreaTopRightX-this.safeAreaTopLeftX,this.safeAreaHeight=this.safeAreaBotRightY-this.safeAreaTopRightY,this.paddingLeft=12*this.scaleRatio,this.paddingRight=12*this.scaleRatio,dom.create("img","m-auto")),e=(t.src="/img/emulator/iphone.png",t.style.width=e+"px",t.style.height=n+"px",this.container.appendChild(t),t.offsetTop),n=t.offsetLeft;this.iframe=dom.create("iframe","position-absolute","border-less"),this.iframe.frameborder="none",this.iframe.src=this.url,this.iframe.style.left=n+this.safeAreaTopLeftX+1+"px",this.iframe.style.top=e+this.safeAreaTopLeftY+1+"px",this.iframe.style.width=this.safeAreaWidth-2+"px",this.iframe.style.height=this.safeAreaHeight-2+"px",this.container.appendChild(this.iframe)},MobileFrame.prototype.preview=function(t,e){var n=this.iframe.contentWindow.document.body;n.innerHTML=t,n.querySelectorAll("img").forEach(function(t){t.style.width="100%"}),e&&e(n)},PaginationGrid.prototype.root=function(){var t=dom.element('\n    <div class="card">\n      <div class="card-body">\n        <div class="row" style="margin-left: -5px; margin-right: -5px;"></div>\n      </div>\n    </div>\n  ');return this.rootBody=t.children[0].children[0],1==this.borderless&&(t.classList.add("b-a-0","mb-0"),t.children[0].classList.add("p-0")),t},PaginationGrid.prototype.request=function(t){var e,r=this;if(t=t||{},this.favourite&&(dom.find("a[widget-id=toggleFavourite] i",this.container).classList.contains("fas")?t._favourite="true":t._favourite="false"),this.widgetFilter){var n,i=this.widgetFilter.getQuery();for(n in i)t[n]=i[n]}if(this.queryFilter){var a,o=this.queryFilter.getValues();for(a in o)t[a]=o[a]}for(e in this.filters)t[e]=this.filters[e];t.start=this.start,t.limit=this.limit,void 0!==this.url&&xhr.post({url:this.url,usecase:this.usecase,data:t}).then(function(t){r.total=t.total;var e=t.data;if(e)if(r.rootBody.innerHTML="",r.showPageNumber(),0==e.length)r.rootBody.innerHTML='<div class="text-center pt-4 full-width">  <img width="48" height="48" src="/img/widget/nodata.png" class="mb-2" style="opacity: 25%;">  <p style="opacity: 40%; color: black;">没有匹配的数据</p></div>';else{for(var n=0;n<e.length;n++){var i=e[n];r.addRow(i,n)}r.addMore()}})},PaginationGrid.prototype.addRow=function(t,e){var n=dom.create("div","gx-24-"+(10<this.colspan?this.colspan:"0"+this.colspan));this.rootBody.appendChild(n),this.onRender(n,t,e)},PaginationGrid.prototype.replaceRow=function(t,e){var n;this.rootBody.children[e]&&((n=this.rootBody.children[e]).innerHTML="",this.onRender(n,t,e))},PaginationGrid.prototype.addMore=function(){var t,e,n,i=this;this.start/this.limit+1!=this.lastPageNumber()&&(t=this.rootBody.children[this.rootBody.children.length-1])&&(e=dom.element('\n    <div class="gx-d-flex gx-w-full" style="align-items:center;justify-content:center;">\n      <a class="btn text-secondary gx-fs-56">\n        <i class="fas fa-ellipsis-h"></i>\n      </a>\n    </div>\n  '),dom.bind(dom.find("a",e),"click",function(t){i.next()}),n=t.getBoundingClientRect().height,e.classList.add(t.classList),e.style.height=n-15+"px",this.rootBody.appendChild(e))},PaginationGrid.prototype.render=function(t,e){this.container="string"==typeof t?document.querySelector(t):t,this.container.innerHTML="";var t=this.root(),n=(this.container.appendChild(this.actionbar()),this.container.appendChild(t),this.container.appendChild(this.pagination()),dom.top(this.container));t.style.height="calc(100% - 20px - "+n+"px)",this.request(e=e||{})},PaginationGrid.prototype.actionbar=function(){var t,e=dom.element('<div class="full-width d-flex overflow-hidden" style="height: 26px;"></div>');return this.widgetQuery&&(t=dom.create("div","widget-query"),this.widgetQuery.render(t),this.container.appendChild(t)),e},PaginationGrid.prototype.pagination=function(){var t=this,e=dom.element('<div class="table-pagination d-flex"></div>'),n=dom.element('<ul class="pagination ms-auto mb-0 mt-2"></ul>'),i=(this.firstPage=dom.element('<li class="page-item"></li>'),dom.element('<a class="page-link b-a-0 font-14"></a>'));return i.setAttribute("href","javascript:void(0)"),i.innerHTML="首页",dom.bind(i,"click",function(){t.go(1)}),this.firstPage.appendChild(i),n.appendChild(this.firstPage),this.prevPage=dom.element('<li class="page-item"></li>'),(i=dom.element('<a class="page-link b-a-0 font-14"></a>')).setAttribute("href","javascript:void(0)"),i.innerHTML="上一页",dom.bind(i,"click",function(){t.prev()}),this.prevPage.appendChild(i),n.appendChild(this.prevPage),li=dom.element('<li class="page-item disabled"></li>'),this.pagebar=dom.element('<a class="page-link b-a-0 font-14"></a>'),this.pagebar.setAttribute("href","javascript:void(0)"),this.pagebar.setAttribute("style","cursor: default"),this.pagebar.innerText="0/0",li.appendChild(this.pagebar),n.appendChild(li),this.nextPage=dom.element('<li class="page-item"></li>'),(i=dom.element('<a class="page-link b-a-0 font-14"></a>')).setAttribute("href","javascript:void(0)"),i.innerHTML="下一页",dom.bind(i,"click",function(){t.next()}),this.nextPage.appendChild(i),n.appendChild(this.nextPage),this.lastPage=dom.element('<li class="page-item"></li>'),(i=dom.element('<a class="page-link b-a-0font-14"></a>')).setAttribute("href","javascript:void(0)"),i.innerHTML="末页",dom.bind(i,"click",function(){t.go(t.lastPageNumber())}),this.lastPage.appendChild(i),n.appendChild(this.lastPage),li=dom.element('<li class="page-item disabled"></li>'),(i=dom.element('<a class="page-link b-a-0 pt-0"></a>')).setAttribute("style","cursor: default"),this.limit<0?n.innerHTML="":n.style.height="34.75px",e.appendChild(n),e},PaginationGrid.prototype.lastPageNumber=function(){return 0==this.total||-1==this.limit?1:0==this.total%this.limit?parseInt(this.total/this.limit):parseInt(this.total/this.limit+1)},PaginationGrid.prototype.prev=function(){this.start<=0||this.go((this.start-this.limit)/this.limit+1)},PaginationGrid.prototype.next=function(){this.start+this.limit>=this.total||this.go((this.start+this.limit)/this.limit+1)},PaginationGrid.prototype.go=function(t,e){t<=0||t>this.lastPageNumber()||(this.start=this.limit*(t-1),this.request(e))},PaginationGrid.prototype.showPageNumber=function(){var t=this.start/this.limit+1,e=this.lastPageNumber()||0,n=this.total||0;this.limit<=0||(this.pagebar.innerHTML=t+"/"+e+"&nbsp;&nbsp;共"+n+"条记录",this.firstPage.classList.remove("disabled"),this.prevPage.classList.remove("disabled"),this.nextPage.classList.remove("disabled"),this.lastPage.classList.remove("disabled"),1==t&&(this.firstPage.classList.add("disabled"),this.prevPage.classList.add("disabled")),t==this.lastPageNumber()&&(this.nextPage.classList.add("disabled"),this.lastPage.classList.add("disabled")))},PaginationTable.prototype.prev=function(){this.start<=0||this.go((this.start-this.limit)/this.limit+1)},PaginationTable.prototype.next=function(){this.start+this.limit>=this.total||this.go((this.start+this.limit)/this.limit+1)},PaginationTable.prototype.go=function(t,e){t<=0||t>this.lastPageNumber()||(this.rollbackStart=this.start,this.start=this.limit*(t-1),this.request(e))},PaginationTable.prototype.render=function(t,e){if(void 0===this.containerId&&(this.containerId=t),null!=this.queryId&&(this.boundedQuery=$("#"+this.queryId)),"string"==typeof this.containerId?0==this.containerId.indexOf("#")?this.container=document.querySelector(this.containerId):this.container=document.getElementById(this.containerId):this.container=t,this.container.innerHTML="",!1!==this.refreshable&&this.container.appendChild(this.tableTopActions(e)),this.widgetExcess&&this.container.appendChild(this.widgetExcess.template),this.container.appendChild(this.root(e)),-1!=this.limit&&this.container.appendChild(this.pagination()),void 0===e||""==e||"{}"==e)this.go(1),this.afterRequest();else if("object"===_typeof(e)){for(var n in e)this.addFilter(n,e[n]);this.request({})}else{t=parseJSON(e);this.request(t),this.afterRequest()}},PaginationTable.prototype.beforeRequest=function(){this.showLoading&&($(this.table.find("tbody")).empty(),$(this.table.find("tbody")).append($("<tr></tr>").append($("<td style='text-align:center'></td>").attr("colspan",this.allcolumns).html('<div class="sk-circle">\n  <div class="sk-circle1 sk-child"></div>\n  <div class="sk-circle2 sk-child"></div>\n  <div class="sk-circle3 sk-child"></div>\n  <div class="sk-circle4 sk-child"></div>\n  <div class="sk-circle5 sk-child"></div>\n  <div class="sk-circle6 sk-child"></div>\n  <div class="sk-circle7 sk-child"></div>\n  <div class="sk-circle8 sk-child"></div>\n  <div class="sk-circle9 sk-child"></div>\n  <div class="sk-circle10 sk-child"></div>\n  <div class="sk-circle11 sk-child"></div>\n  <div class="sk-circle12 sk-child"></div>\n</div>'))))},PaginationTable.prototype.afterRequest=function(){},PaginationTable.prototype.requestError=function(){this.table.find("div.loaddingct").html('<h6 style="color:#dc3545">数据加载出错，请联系管理员解决...</h6>')},PaginationTable.prototype.root=function(t){void 0===t&&(t={});var e=dom.element('<div class="full-width"></div>'),i=(e.style.overflowY="auto",this.table=dom.element("<table></table>"),void 0!==this.width&&(this.table.style.width=this.width),void 0!==this.height&&(e.style.height=this.height),this.table.classList.add("table","table-responsive-sm","table-outline","mb-0"),this.hoverable&&this.table.classList.add("table-hover"),this.table.style.overflow="hidden",this),n=dom.create("thead");n.style="height: 43px;",n.classList.add("thead-light");for(var r=0;r<this.columnMatrix.length;++r){for(var a=dom.create("tr"),o=0;o<this.columnMatrix[r].length;++o){var s,l=this.columnMatrix[r][o],d=dom.create("th"),c=(d.style="vertical-align:middle;z-index:900;",o<this.frozenColumnCount&&d.classList.add("headcol"),dom.element("<span class='pull-right fa fa-arrows-v'></span>"));c.style.opacity="0.3",c.style.marginTop="2px",c.classList.add("fa"),dom.bind(c,"click",function(t){var e="asc",n=t.target;n.classList.contains("fa-arrows-v")?(n.classList.add("fa-arrows-v"),n.classList.remove("fa-sort-amount-asc"),n.style.opacity="0.6",e="asc"):n.classList.contains("fa-sort-amount-asc")?(n.classList.remove("fa-sort-amount-asc"),n.classList.add("fa-sort-amount-desc"),e="desc"):n.classList.contains("fa-sort-amount-desc")&&(n.classList.remove("fa-sort-amount-desc"),n.classList.add("fa-sort-amount-asc"),e="asc"),n.classList.contains("fa-arrows-v")||i.table.querySelectorAll("th span").forEach(function(t,e){n.getAttribute("data-order")!=t.getAttribute("data-order")&&(t.classList.remove("fa-sort-amount-asc"),t.classList.remove("fa-sort-amount-desc"),t.classList.addEventListener("fa-arrows-v"),t.style.opacity="0.3")}),i.filters.orderBy=n.attr("data-order"),i.filters.sorting=e,i.request()}),d.setAttribute("rowspan",l.rowspan||1),d.setAttribute("colspan",l.colspan||1),void 0!==l.width&&(d.style.width=l.width),1==this.frozenHeader&&(n.style.float="left",d.style.float="left"),l.style?(d.style=d.style||"",d.setAttribute("style",d.style+"; vertical-align:middle;"+l.style)):(d.style.textAlign="center",d.style.verticalAlign="middle"),void 0===l.headerClick?d.innerText=l.title:(s=dom.element("<a></a>"),dom.bind(s,"click",l.headerClick),d.appendChild(s),s.style.cursor="default",s.innerText=l.title),void 0!==l.order&&(c.setAttribute("data-order",l.order),l.order===t.orderBy&&(c.classList.remove("fa sort"),"asc"===t.sorting?c.classList.add("fa fa-sort-amount-asc"):c.classList.add("fa fa-sort-amount-desc")),d.appendChild(c)),a.appendChild(d)}n.appendChild(a)}return this.headless||this.table.appendChild(n),this.table.appendChild(dom.create("tbody")),e.appendChild(this.table),e},PaginationTable.prototype.pagination=function(){var t=this,e=dom.element('<div class="table-pagination d-flex"></div>'),n=dom.element('<ul class="pagination ms-auto mb-0 mt-2"></ul>'),i=(this.firstPage=dom.element('<li class="page-item"></li>'),dom.element('<a class="page-link b-a-0 font-14"></a>'));return i.setAttribute("href","javascript:void(0)"),i.innerHTML="首页",dom.bind(i,"click",function(){t.go(1)}),this.firstPage.appendChild(i),"full"===this.style&&n.appendChild(this.firstPage),this.prevPage=dom.element('<li class="page-item"></li>'),(i=dom.element('<a class="page-link b-a-0 font-14"></a>')).setAttribute("href","javascript:void(0)"),i.innerHTML="上一页",dom.bind(i,"click",function(){t.prev()}),this.prevPage.appendChild(i),n.appendChild(this.prevPage),li=dom.element('<li class="page-item disabled"></li>'),this.pagebar=dom.element('<a class="page-link b-a-0 font-14"></a>'),this.pagebar.setAttribute("href","javascript:void(0)"),this.pagebar.setAttribute("style","cursor: default"),this.pagebar.innerText="0/0",li.appendChild(this.pagebar),n.appendChild(li),this.nextPage=dom.element('<li class="page-item"></li>'),(i=dom.element('<a class="page-link b-a-0 font-14"></a>')).setAttribute("href","javascript:void(0)"),i.innerHTML="下一页",dom.bind(i,"click",function(){t.next()}),this.nextPage.appendChild(i),n.appendChild(this.nextPage),this.lastPage=dom.element('<li class="page-item"></li>'),(i=dom.element('<a class="page-link b-a-0font-14"></a>')).setAttribute("href","javascript:void(0)"),i.innerHTML="末页",dom.bind(i,"click",function(){t.go(t.lastPageNumber())}),this.lastPage.appendChild(i),"full"===this.style&&n.appendChild(this.lastPage),li=dom.element('<li class="page-item disabled"></li>'),(i=dom.element('<a class="page-link b-a-0 pt-0"></a>')).setAttribute("style","cursor: default"),this.limit<0?n.innerHTML="":n.style.height="34.75px",e.appendChild(n),e},PaginationTable.prototype.tableTopActions=function(){var t,e,n,i,r,a;if(!1!==this.showTop)return t=this,e=dom.element('<div class="full-width d-flex overflow-hidden" style="height: 26px;display:none!important;"></div>'),this.optsFilter2?(n={},utils.clone(this.optsFilter2,n),(n.table=this).queryFilter=new QueryFilter(n),e.appendChild(this.queryFilter.getRoot())):e.appendChild(dom.element('<div class="full-width"></div>')),n=e,this.group&&(a=dom.element('<a widget-id="toggleGroup" class="card-header-action text-primary ml-2">\n  <i class="fas fa-bars"></i>\n</a>'),n.appendChild(a)),this.widgetSort&&((i=dom.create("div","card","widget-sort","fade","fadeIn")).zIndex=9999,this.widgetSort.render(i),this.container.appendChild(i),a=dom.element('<a widget-id="toggleSort" class="card-header-action text-primary ml-2">\n  <i class="fas fa-sort-amount-down-alt position-relative" style="top: 4px; font-size: 17px;"></i>\n</a>'),dom.bind(a,"click",function(){i.classList.contains("show")?i.classList.remove("show"):i.classList.add("show")}),n.appendChild(a)),this.widgetQuery&&(r=dom.create("div","widget-query"),this.widgetQuery.render(r),this.container.appendChild(r),a=dom.element('<a widget-id="toggleFilter" class="card-header-action text-primary">\n  <i class="fas fa-filter position-relative" style="top: 4px;"></i>\n</a>'),dom.bind(a,"click",function(){var t=r;t.classList.contains("show")?t.classList.remove("show"):t.classList.add("show")}),n.appendChild(a)),this.refreshable&&(a=dom.element('<a widget-id="toggleFilter" class="card-header-action text-primary ml-2">\n  <i class="fas fa-sync-alt position-relative" style="top: 4px;"></i>\n</a>'),dom.bind(a,"click",function(){t.request()}),n.appendChild(a)),e},PaginationTable.prototype.showPageNumber=function(){var t=this.start/this.limit+1,e=this.lastPageNumber()||0,n=this.total||0;this.limit<=0||(this.pagebar.innerHTML=t+"/"+e+"&nbsp;&nbsp;共"+n+"条记录",0==n||1==this.lastPageNumber()?(this.firstPage.classList.add("disabled"),this.prevPage.classList.add("disabled"),this.nextPage.classList.add("disabled"),this.lastPage.classList.add("disabled")):(1==t?(this.firstPage.classList.add("disabled"),this.prevPage.classList.add("disabled"),this.nextPage.classList.remove("disabled"),this.lastPage):t==this.lastPageNumber()?(this.nextPage.classList.add("disabled"),this.lastPage.classList.add("disabled"),this.firstPage.classList.remove("disabled"),this.prevPage):(this.firstPage.classList.remove("disabled"),this.prevPage.classList.remove("disabled"),this.nextPage.classList.remove("disabled"),this.lastPage)).classList.remove("disabled"))},PaginationTable.prototype.disablePaging=function(){this.limit<=0||(this.firstPage.removeClass(),this.prevPage.removeClass(),this.nextPage.removeClass(),this.lastPage.removeClass(),this.firstPage.addClass("disabled"),this.prevPage.addClass("disabled"),this.nextPage.addClass("disabled"),this.lastPage.addClass("disabled"))},PaginationTable.prototype.lastPageNumber=function(){return 0==this.total||-1==this.limit?1:0==this.total%this.limit?parseInt(this.total/this.limit):parseInt(this.total/this.limit+1)},PaginationTable.prototype.maxColSpan=function(t){for(var e=1,n=0,i=0;t.children&&i<t.children.length;++i)n=Math.max(n,this.maxColSpan(t.children[i]));return e+=n},PaginationTable.prototype.clear=function(){dom.find("tbody",this.table).innerHTML=""},PaginationTable.prototype.buildMappingColumns=function(t){for(var e=0;e<t.length;e++){var n=t[e];n.children&&0!=n.children.length?this.buildMappingColumns(n.children):this.mappingColumns.push(n)}},PaginationTable.prototype.buildMatrix=function(t,e){if(t)for(var n=e,i=0;i<t.length;++i){var r=t[i];r.children&&0<r.children.length&&(r.colspan=r.colspan||1,this.buildMatrix(r.children,e+1)),this.columnMatrix[n].push(r)}},PaginationTable.prototype.request=function(t){var e,n=this,i={};if(null!=n.boundedQuery){var r,a=n.boundedQuery.formdata();for(r in a)this.filters[r]=a[r]}if(i=i||{},this.widgetQuery){var o,s=this.widgetQuery.getQuery();for(o in s)i[o]&&i&&0==o.indexOf("_")?i[o]+=" "+s[o]:i[o]=s[o]}if(this.queryFilter){var l,d=this.queryFilter.getValues();for(l in d)i[l]&&0==l.indexOf("_")?i[l]+=" "+d[l]:i[l]=d[l]}for(e in this.filters)i[e]&&0==e.indexOf("_")?i[e]+=" "+this.filters[e]:i[e]=this.filters[e];if(void 0!==t)for(var c in t)"start"==c?this.start=parseInt(t[c]):"limit"==c?this.limit=parseInt(t[c]):(i[c],i[c]=t[c]);i.start=this.start,i.limit=this.limit,void 0!==this.url?(this.beforeRequest(),xhr.post({url:this.url,usecase:this.usecase,data:i,error:function(t){n.start=n.rollbackStart,n.showPageNumber(),n.requestError()}}).then(function(t){t.total||(t.total=0,t.data=[]),n.resultFilters&&(t=n.resultFilters(t)),n.total=t.total,n.fill(t),n.showPageNumber(),n.afterLoad(t)})):this.loadLocal()},PaginationTable.prototype.loadLocal=function(){this.local||(this.local={total:0,data:[]}),this.total=this.local.total;var t={};if(t.total=this.local.total,t.data=[],-1!=this.limit)for(var e=this.start;e<this.start+this.limit&&e<this.local.total;e++)t.data.push(null==this.local.data[e]?"&nbsp;":this.local.data[e]);else t=this.local;this.fill(t),this.showPageNumber(),this.afterLoad(t)},PaginationTable.prototype.addFilter=function(t,e){this.filters[t]=e},PaginationTable.prototype.clearFilters=function(){this.filters={}},PaginationTable.prototype.replace=function(t,e,n){return t.replace(new RegExp(e,"g"),n)},PaginationTable.prototype.fill=function(t){this.clear();var e=this;for(var n={total:t.total,data:[]},i=null,r={},a={},o=0;o<t.data.length;o++)if(0==this.totalFields.length)n.data.push(t.data[o]);else for(var s=t.data[o],l=s[this.groupField],d=(l!=(i=null==i?l:i)?(i=l,a[this.mappingColumns[0].title]="小计",n.data.push(a),n.data.push(t.data[o]),(a={})[this.mappingColumns[0].title]="小计"):n.data.push(t.data[o]),m=f=h=p=u=c=d=void 0,r),c=a,u=s,p=0;p<e.totalFields.length;p++){var h=e.totalFields[p],f=parseFloat(u[h]),m=(isNaN(f)&&(f=0),parseFloat(d[h]));isNaN(m)&&(m=0),m+=f,d[h]=m,c&&(m=parseFloat(c[h]),isNaN(m)&&(m=0),m+=f,c[h]=m)}0<this.totalFields.length&&(a[this.mappingColumns[0].title]="小计",n.data.push(a)),0<this.totalFields.length&&(r[this.mappingColumns[0].title]="合计",n.data.push(r));this.mappingColumns;if(n.data&&n.data[0]){var g=(g=this.limit)<0?n.data.length:g,y=dom.find("tbody",this.table);void 0!==this.tbodyHeight&&(y.style.height=this.tbodyHeight,y.style.overflowY="auto");for(var v,b=0;b<g;++b)b<n.data.length&&(v=n.data[b],this.appendRow(v,b))}else dom.find("tbody",this.table).innerHTML='\n      <tr class="no-hover">\n        <td colspan="100" class="text-center pt-4">\n          <img width="48" height="48" src="/img/widget/nodata.png" class="mb-2" style="opacity: 25%;">\n          <p style="opacity: 40%; color: black;">没有匹配的数据</p>\n        </td>\n      </tr>\n    '},PaginationTable.prototype.appendRow=function(t,e){var n=dom.find("tbody",this.table),i=dom.find("tr.no-hover",n),r=(null!=i&&i.remove(),dom.create("tr"));dom.model(r,t),r.style.height=this.columnHeight;for(var a=0;a<this.mappingColumns.length;++a){var o=this.mappingColumns[a],s=dom.create("td");if(a<this.frozenColumnCount&&s.classList.add("headcol"),o.style?s.setAttribute("style",o.style):s.setAttribute("style","text-align: center; vertical-align:middle;"),void 0!==o.width&&(s.style.width=o.width),!0===this.frozenHeader&&(n.style.float="left",s.style.float="left"),o.template){var l,d=o.template.toString();for(l in t)t[l]=null==t[l]?"-":t[l],d=this.replace(d,"\\{"+l+"\\}",t[l]);0==d.indexOf("{")&&-1!=d.indexOf("}")&&(d="-"),s.html(d)}o.display&&o.display(t,s.get(0),a,void 0===e?-1:e,this.start),r.appendChild(s)}n.appendChild(r)},PaginationTable.prototype.appendOrReplaceRow=function(t,e){var n=dom.find("tbody",this.container),i=dom.find("tr.no-hover",n),r=(null!=i&&i.remove(),dom.create("tr"));dom.model(r,t),r.style.height=this.columnHeight;for(var a=0;a<this.mappingColumns.length;++a){var o=this.mappingColumns[a],s=dom.create("td");if(a<this.frozenColumnCount&&s.classList.add("headcol"),o.style?s.style=o.style:s.style="text-align: center; vertical-align:middle;",void 0!==o.width&&s.css("width",o.width),o.template){var l,d=o.template.toString();for(l in t)t[l]=null==t[l]?"-":t[l],d=this.replace(d,"\\{"+l+"\\}",t[l]);0==d.indexOf("{")&&-1!=d.indexOf("}")&&(d="-"),s.html(d)}o.display&&o.display(t,s,a,void 0===e?-1:e,this.start),r.appendChild(s)}void 0!==e?(i=n.rows[e],n.replaceChild(r,i)):n.appendChild(r)},PaginationTable.prototype.getData=function(){for(var t=[],e=dom.find("tbody",this.table).querySelectorAll("tr"),n=0;n<e.length;n++){var i=e[n];i.classList.contains("no-hover")||(i=dom.model(i),t.push(i))}return t},PaginationTable.prototype.stack=function(t,e,n,i){n=n||{};var r,a=dom.find("tbody",this.container),o=a.children[t+1];null!=o&&"stack"==o.getAttribute("role")||(null!=(o=dom.find("tr[role=stack]",a))&&(o.rowIndex<=t&&t--,o.remove()),t=a.children[t],(o=dom.create("tr","fade","fadeInDown")).setAttribute("role","stack"),r=dom.create("td"),o.style.backgoundColor="white",r.setAttribute("colspan",this.columns.length),o.appendChild(r),null==t||null==t.nextSibling?a.appendChild(o):a.insertBefore(o,t.nextSibling),xhr.get({url:e,success:function(t){utils.append(r,t),i&&i(r,n),setTimeout(function(){o.classList.add("show")},300)}}))},PaginationTable.prototype.unstack=function(){var t=dom.find("tbody",this.container),t=dom.find("tr[role=stack]",t);null!=t&&t.remove()};var ICON_CLEAR='<i class="fas fa-backspace text-danger position-relative" style="left: -4px;"></i>';function QueryLayout(t){this.fields=t.fields,this.actions=t.actions||[],this.queryOpt=t.query||{},this.columnCount=t.columnCount||3,this.convert=t.convert}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function QuestionnaireDesigner(t){this.title=t.title||"问卷调查",this.questions=t.questions||[],this.draggingTarget=null,this.onSave=t.onSave||function(t){},this.onDelete=t.onDelete||function(t){},QuestionnaireDesigner.instance=this}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ReadonlyForm(t){this.container=dom.find(t.containerId),this.url=t.url,this.params=t.params||{},this.local=t.local,this.columnCount=t.columnCount||1,this.fields=t.fields,this.convert=t.convert,this.container&&this.render(this.container,this.params)}QueryLayout.prototype.render=function(t,e,n){var i=this;if(this.container="string"==typeof t?document.querySelector(t):t,e)this.fetch(e);else{n=n||{};for(var r=dom.create("div","row","mx-0"),a=this.columnCount,o=[],s=[],l=0;l<this.fields.length;l++){var d=this.fields[l];d.value=void 0===n[d.name]?null:n[d.name],("hidden"==d.input?o:s).push(d)}for(var c=0;c<s.length;c++){var u=s[c],p=dom.create("div",(u&&u.input,"form-group"),"gx-24-"+((p=24/this.columnCount)<10?"0"+p:p),"row","mx-0"),u=this.createInput(u,a);p.appendChild(u.label),p.appendChild(u.input),r.appendChild(p)}this.container.appendChild(r);for(var h=0;h<this.fields.length;h++){var f=this.fields[h];if("date"==f.input){var m=dom.find('input[name="'+f.name+'"]',this.container);new Datepicker(m,{format:"yyyy-mm-dd",language:"zh-CN",autohide:!0});null!=f.value&&(dom.find("input[name='"+f.name+"']",this.container).value=moment(f.value).format("YYYY-MM-DD"))}else if("select"==f.input){var g=f.options,y=(g.validate=EditableForm.validate,Array.isArray(f.value)?g.selection=f.value[0][g.fields.value]:g.selection=f.value,dom.find('select[name="'+f.name+'"]',this.container));if(y.append(dom.element('<option data-placeholder="true"></option>')),g.values)for(var v=0;v<g.values.length;v++)y.append(dom.element('<option value="'+g.values[v].value+'">'+g.values[v].text+"</option>"));new SlimSelect({select:y,placeholder:!0,settings:{allowDeselect:!0,showSearch:!1,placeholderText:"请选择…",contentPosition:"absolute"}})}else if("cascade"==f.input){for(var b=f.options,w=0;w<b.levels.length;w++)b.levels[w];b.container=dom.find('div[data-cascade-name="'+f.name+'"]',this.container),new CascadeSelect(b)}}var t=dom.element('<div class="row ml-0 mr-0 full-width mt-3"><div class="full-width d-flex"></div></div>'),e=dom.create("div","ms-auto"),x=dom.create("button","btn","btn-primary","btn-sm","gx-mr-12"),E=(x.textContent="搜索",dom.bind(x,"click",function(){i.queryOpt.callback&&(i.queryOpt.convert?i.queryOpt.callback(i.queryOpt.convert(dom.formdata(i.container))):i.queryOpt.callback(dom.formdata(i.container)))}),e.appendChild(x),e.append(" "),dom.create("button","btn","btn-sm","btn-warning"));E.textContent="清除",dom.bind(E,"click",function(){dom.formdata(i.container,{})}),e.appendChild(E),e.append(" "),t.firstElementChild.appendChild(e),r.appendChild(t),this.container.addEventListener("keypress",function(t){13===t.keyCode&&x.click()})}},QueryLayout.prototype.getQuery=function(){return this.convert?this.convert(dom.formdata(this.container)):dom.formdata(this.container)},QueryLayout.prototype.createInput=function(t,e){e=e||1;var e=dom.create("div","col-form-label","gx-24-08","pl-3"),n=(e.innerText=t.title+"：",dom.create("div","gx-24-16","input-group")),i=null;if("select"==t.input)(i=dom.create("select","form-control")).style.width="100%",i.disabled=this.readonly,i.setAttribute("name",t.name),i.setAttribute("placeholder","请选择...");else if("cascade"==t.input)i=dom.create("div","form-control","sm30"),this.readonly&&(i.style.backgroundColor="rgb(240, 243, 245)"),i.setAttribute("data-cascade-name",t.name),i.setAttribute("placeholder","请选择...");else if("check"==t.input)for(var r=0;r<t.values.length;r++){var a=t.values[r],o=dom.element('\n        <div class="form-check form-check-inline">\n          <input id="" name="" value="" type="checkbox"\n                 class="form-check-input checkbox color-primary is-outline">\n          <label class="form-check-label" for=""></label>\n        </div>\n      ');dom.find("input",o).id="check_"+a.value,dom.find("input",o).name=t.name,t.value?dom.find("input",o).checked=t.value==a.value:dom.find("input",o).checked=1==a.checked,dom.find("input",o).value=a.value,dom.find("label",o).setAttribute("for","check_"+a.value),dom.find("label",o).textContent=a.text,n.append(o)}else(i=dom.create("input","form-control")).disabled=this.readonly,i.setAttribute("name",t.name),i.setAttribute("placeholder","请输入...");return null!=i&&n.appendChild(i),"date"==t.input?(i.setAttribute("data-domain-type","date"),i.setAttribute("placeholder","请选择...")):0==t.input.indexOf("number")&&i.setAttribute("data-domain-type",t.input),{label:e,input:n}},QueryLayout.prototype.createButton=function(t){var e=dom.create("button","btn","btn-sm","btn-"+t.role);return e.innerText=t.text,e.addEventListener("click",t.click),e},QuestionnaireDesigner.QUESTION_MULTIPLE_CHOICE="multiple",QuestionnaireDesigner.QUESTION_SINGLE_CHOICE="single",QuestionnaireDesigner.QUESTION_SHORT_ANSWER="answer",QuestionnaireDesigner.ATTRIBUTE_TITLE="data-questionnaire-question-title",QuestionnaireDesigner.ATTRIBUTE_TYPE="data-questionnaire-question-type",QuestionnaireDesigner.ATTRIBUTE_ORDINAL_POSITION="data-questionnaire-question-ordinal-position",QuestionnaireDesigner.ATTRIBUTE_VALUES="data-questionnaire-question-values",QuestionnaireDesigner.ATTRIBUTE_MODEL="data-questionnaire-question-model",QuestionnaireDesigner.COLOR_SELECTED="#3880ff",QuestionnaireDesigner.MODEL_MULTIPLE_CHOICE='\n{\n"title":"多选题示例",\n"type":"multiple",\n"values": ["选线A","选项B","选项C","选项D"]\n}\n',QuestionnaireDesigner.MODEL_SINGLE_CHOICE='\n{\n"title":"单选题示例",\n"type":"single",\n"values": ["选项A","选项B","选项C","选项D"]\n}\n',QuestionnaireDesigner.MODEL_SHORT_ANSWER='\n{\n"title":"简答题示例",\n"type":"answer"\n}\n',QuestionnaireDesigner.prototype.palette=function(){var t=dom.element('<div class="col-md-4" style="padding: 0; border-radius: unset;"></div>'),e=dom.create("ul","list-group","mt-2","ml-4"),n=dom.create("li","list-group-item","grab");return n.setAttribute("draggable",!0),n.setAttribute(QuestionnaireDesigner.ATTRIBUTE_TYPE,QuestionnaireDesigner.QUESTION_SINGLE_CHOICE),n.innerText="单选题",e.appendChild(n),dnd.setDraggable(n,{model:QuestionnaireDesigner.MODEL_SINGLE_CHOICE},function(){}),(n=dom.create("li","list-group-item","grab")).setAttribute("draggable",!0),n.setAttribute(QuestionnaireDesigner.ATTRIBUTE_TYPE,QuestionnaireDesigner.QUESTION_MULTIPLE_CHOICE),n.innerText="多选题",e.appendChild(n),dnd.setDraggable(n,{model:QuestionnaireDesigner.MODEL_MULTIPLE_CHOICE},function(){}),(n=dom.create("li","list-group-item","grab")).setAttribute("draggable",!0),n.setAttribute(QuestionnaireDesigner.ATTRIBUTE_TYPE,QuestionnaireDesigner.QUESTION_SHORT_ANSWER),n.innerText="问答题",e.appendChild(n),dnd.setDraggable(n,{model:QuestionnaireDesigner.MODEL_SHORT_ANSWER},function(){}),t.appendChild(e),dom.autoheight(t,this.container,0),t},QuestionnaireDesigner.prototype.canvas=function(){var o=this,s=this,t=dom.element('\n    <div class="col-md-8 m-0">\n      <div widget-id="widgetQuestionnaireCanvas" \n           style="padding: 10px; \n           margin-top: 8px;\n           margin-bottom: 8px;\n           background-color: white; \n           overflow-y: auto; \n           border: 4px dashed rgba(0, 0, 0, 0.3);">\n      </div>\n    </div>\n  '),e=this.container.getBoundingClientRect();return this.widgetQuestionnaireCanvas=dom.find("[widget-id=widgetQuestionnaireCanvas]",t),this.widgetQuestionnaireCanvas.style.height=e.height-8+"px",this.questions.forEach(function(t,e){t.ordinalPosition=e+1,o.renderQuestion(o.widgetQuestionnaireCanvas,t)}),this.widgetQuestionnaireCanvas.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation();t.clientX;var e=t.clientY,t=dom.find("[data-questionnaire-question-clone=true]",o.widgetQuestionnaireCanvas);if(null!=t&&t.remove(),null!=s.draggingTarget){for(var n=s.draggingTarget.cloneNode(!0),i=(n.style.opacity="0.5",n.setAttribute("data-questionnaire-question-clone","true"),s.draggingTarget.remove(),!1),r=0;r<o.widgetQuestionnaireCanvas.children.length;r++){var a=o.widgetQuestionnaireCanvas.children[r];if(a.getBoundingClientRect().bottom>e){o.widgetQuestionnaireCanvas.insertBefore(n,a),i=!0;break}}!1===i&&o.widgetQuestionnaireCanvas.appendChild(n),s.resort(o.widgetQuestionnaireCanvas)}}),dnd.setDroppable(this.widgetQuestionnaireCanvas,function(t,e,n){if(null!=s.draggingTarget){s.draggingTarget.remove(),s.draggingTarget=null;var i=dom.find("[data-questionnaire-question-clone=true]",o.widgetQuestionnaireCanvas);i.style.opacity="",i.removeAttribute("data-questionnaire-question-clone"),dom.bind(i,"click",function(t){t.preventDefault(),t.stopPropagation(),o.clearAndSelect(i)}),s.resort(i.parentElement),s.clearAndSelect(i,!0)}else{for(var r=0;r<o.widgetQuestionnaireCanvas.children.length;r++){o.widgetQuestionnaireCanvas.children[r].style.borderColor="transparent";var a=dom.find("[widget-id=operations]",o.widgetQuestionnaireCanvas.children[r]);null!=a&&a.remove()}o.renderQuestion(o.widgetQuestionnaireCanvas,JSON.parse(n.model))}o.dispatchEvent()}),dom.bind(this.widgetQuestionnaireCanvas,"click",function(t){for(var e=0;e<o.widgetQuestionnaireCanvas.children.length;e++)o.clearAndSelect(o.widgetQuestionnaireCanvas.children[e],!0)}),t},QuestionnaireDesigner.prototype.render=function(t,e){(e=e||{}).questions&&(this.questions=e.questions),this.container=dom.find(t),this.container.innerHTML="",this.container.appendChild(this.palette()),this.container.appendChild(this.canvas())},QuestionnaireDesigner.prototype.renderMultipleChoice=function(t,e){var n=this,i=!0,r=(e.id||(e.ordinalPosition=t.children.length+1,e.id="multiple_"+Date.now(),i=!1),_objectSpread({},e)),a=(delete r.id,delete r.ordinalPosition,e.model=JSON.stringify(r),dom.templatize('\n    <div data-questionnaire-question-id="{{id}}" data-questionnaire-question-model="{{model}}" \n         class="questionnaire-question" style="margin-bottom: 12px; padding: 6px; border: 6px solid transparent;">\n      <div style="margin-bottom: 6px">\n        <strong>{{ordinalPosition}}. {{title}}：</strong>\n      </div>\n      {{#each values}}\n      <div class="questionnaire-answer d-flex">\n        <i class="far fa-check-square"></i>\n        <label>{{this}}</label>\n      </div>\n      {{/each}}\n    </div>\n  ',e));dom.bind(a,"click",function(t){t.preventDefault(),t.stopPropagation(),n.clearAndSelect(a)}),!0===i&&(r=dom.find('[data-questionnaire-question-id="'+e.id+'"]'))?t.replaceChild(a,r):t.appendChild(a)},QuestionnaireDesigner.prototype.renderSingleChoice=function(t,e){var n,i=this,r=!0,a=(e.id||(e.ordinalPosition=t.children.length+1,e.id="single_"+Date.now(),r=!1),_objectSpread({},e)),o=(delete a.id,delete a.ordinalPosition,e.model=JSON.stringify(a),!0!==r||e.ordinalPosition||(a=dom.find('[data-questionnaire-question-id="'+e.id+'"]'),n=Array.prototype.slice.call(t.children),e.ordinalPosition=n.indexOf(a)+1),dom.templatize('\n    <div data-questionnaire-question-id="{{id}}" \n         data-questionnaire-question-model="{{model}}" \n         data-switch=".questionnaire-answer+.checked"\n         class="questionnaire-question" style="margin-bottom: 12px; padding: 6px; border: 6px solid transparent;">\n      <div style="margin-bottom: 6px">\n        <strong>{{ordinalPosition}}. {{title}}：</strong>\n      </div>\n      {{#each values}}\n      <div class="questionnaire-answer d-flex" data-questionnaire-question-name="{{../id}}">\n        <i class="far fa-check-circle"></i>\n        <label>{{this}}</label>\n      </div>\n      {{/each}}\n    </div>\n  ',e));dom.bind(o,"click",function(t){t.preventDefault(),t.stopPropagation(),i.clearAndSelect(o)}),!0===r&&(n=dom.find('[data-questionnaire-question-id="'+e.id+'"]'))?t.replaceChild(o,n):t.appendChild(o)},QuestionnaireDesigner.prototype.renderShortAnswer=function(t,e){var n=this,i=!0,r=(e.id||(e.ordinalPosition=t.children.length+1,e.id="answer_"+(new Date).getMilliseconds(),i=!1),_objectSpread({},e)),a=(delete r.id,delete r.ordinalPosition,e.model=JSON.stringify(r),dom.templatize('\n    <div data-questionnaire-question-id="{{id}}" data-questionnaire-question-model="{{model}}" class="questionnaire-question"  style="margin-bottom: 12px; padding: 6px; border: 6px solid transparent;">\n      <div style="margin-bottom: 6px">\n        <strong>{{ordinalPosition}}. {{title}}：</strong>\n      </div>\n      <div>\n        <textarea name="{{id}}" style="width: 100%; height: 120px; resize: none; outline: none; box-shadow: none;  background-color: transparent;" readonly></textarea>\n      </div>\n    </div>\n  ',e));dom.bind(a,"click",function(t){t.preventDefault(),t.stopPropagation(),n.clearAndSelect(a)}),!0===i&&(r=dom.find('[data-questionnaire-question-id="'+e.id+'"]'))?t.replaceChild(a,r):t.appendChild(a)},QuestionnaireDesigner.prototype.clearAndSelect=function(n,t){var i=this,r=this;if(null!=n.parentElement){for(var e,a=0;a<n.parentElement.children.length;a++){n.parentElement.children[a].style.borderColor="transparent";var o=dom.find("[widget-id=operations]",n.parentElement.children[a]);null!=o&&o.remove()}!0!==t&&(n.style.borderColor=QuestionnaireDesigner.COLOR_SELECTED,(t=dom.element('\n    <div widget-id="operations" style="position: relative; float: right; right: -6px; bottom: 25px;">\n      <a widget-id="buttonMove" class="btn text-light" style="cursor: move;">\n        <i class="fas fa-arrows-alt"></i>\n      </a>\n      <a widget-id="buttonEdit" class="btn text-light"">\n        <i class="fas fa-edit"></i>\n      </a>\n      <a widget-id="buttonDelete" class="btn text-light">\n        <i class="fas fa-trash-alt"></i>\n      </a>\n    </div>\n  ')).style.backgroundColor=QuestionnaireDesigner.COLOR_SELECTED,e=dom.find("a[widget-id=buttonMove",t),dom.bind(e,"mousedown",function(t){t=dom.ancestor(t.target,"div","questionnaire-question");dnd.setDraggable(t,{model:t.getAttribute("data-questionnaire-question-model")},function(t,e,n){r.draggingTarget=n,dnd.clearDraggable(n)})}),e=dom.find("a[widget-id=buttonEdit]",t),dom.bind(e,"click",function(t){var e=n.getAttribute(QuestionnaireDesigner.ATTRIBUTE_MODEL),e=JSON.parse(e),e=_objectSpread(_objectSpread({},e),{},{id:n.getAttribute("data-questionnaire-question-id")});i.edit(e)}),e=dom.find("a[widget-id=buttonDelete]",t),dom.bind(e,"click",function(t){var e=JSON.parse(n.getAttribute("data-questionnaire-question-model"));e.questionnaireQuestionId||(e.questionnaireQuestionId=n.getAttribute("data-questionnaire-question-id")),i.onDelete(e,n)}),n.appendChild(t))}},QuestionnaireDesigner.prototype.resort=function(t){for(var e=0;e<t.children.length;e++){var n=t.children[e],i=dom.find("strong",n),r=i.innerText,i=(i.innerText=r.replace(/\d+\./i,e+1+"."),JSON.parse(n.getAttribute("data-questionnaire-question-model")));i.ordinalPosition=e+1,n.setAttribute("data-questionnaire-question-model",JSON.stringify(i))}},QuestionnaireDesigner.prototype.renderQuestion=function(t,e){e.type===QuestionnaireDesigner.QUESTION_MULTIPLE_CHOICE?this.renderMultipleChoice(t,e):e.type===QuestionnaireDesigner.QUESTION_SINGLE_CHOICE?this.renderSingleChoice(t,e):e.type===QuestionnaireDesigner.QUESTION_SHORT_ANSWER&&this.renderShortAnswer(t,e)},QuestionnaireDesigner.prototype.renderQuestions=function(t){for(var e=0;e<t.length;e++)this.renderQuestion(this.widgetQuestionnaireCanvas,t[e])},QuestionnaireDesigner.prototype.edit=function(t){var i=this,r=(Handlebars.registerHelper("ifne",function(t,e,n){return t!=e?n.fn(this):n.inverse(this)}),t.id);t.options=[],t.values=t.values||[];for(var e=0;e<t.values.length;e++)t.options.push({value:t.values[e],score:t.scores?t.scores[e]:"0"});var n=dom.templatize('\n    <div>\n    <div widget-id="dialogQuestionEdit" class="card border-less">\n      <div class="card-body">\n        <div class="row">\n          <div class="col-sm-12">\n            <div class="form-group">\n              <input class="form-control" name="id" type="hidden" value="{{id}}">\n              <input class="form-control" name="ordinalPosition" type="hidden" value="{{ordinalPosition}}">\n              <input class="form-control" name="type" type="hidden" value="{{type}}">\n              <label for="name"><strong>标题</strong></label>\n              <input class="form-control" name="title" type="text" value="{{title}}">\n            </div>\n          </div>\n        </div>  \n        {{#ifne type "answer"}}\n        <div class="row">\n          <div class="col-sm-12">\n            <div class="form-group">\n              <label for="name">\n                <strong>选项</strong>\n                <a widget-id="buttonAdd" class="btn btn-link">\n                  <i class="fas fa-plus-circle"></i>\n                </a>\n              </label>\n              <ul class="list-group">\n                {{#each options}}\n                <li class="list-group-item d-flex pt-0 pb-0">\n                  <input onfocus="QuestionnaireDesigner.instance.onCellFocus(this);" \n                         onkeydown="QuestionnaireDesigner.instance.onCellKeyPress(event);"\n                         name="values" style="border: none; height=100%; width: 100%" value="{{value}}">\n                  <input onfocus="QuestionnaireDesigner.instance.onCellFocus(this);" \n                         onkeydown="QuestionnaireDesigner.instance.onCellKeyPress(event);"\n                         name="scores" style="border: none; width: 50px" value="{{score}}">\n                  <a class="btn text-danger line-height-32" onclick="this.parentElement.remove();">\n                    <span class="material-icons">highlight_off</span>\n                  </a>\n                </li>\n                {{/each}}\n              </ul>\n            </div>\n          </div>\n        </div>  \n        {{/ifne}}\n      </div>\n      </div>\n      <div>\n        <span class="keyboard-key material-icons">arrow_upward</span>和\n        <span class="keyboard-key material-icons">arrow_downward</span>\n        可以用于切换输入框。\n      </div>\n    </div>\n  ',t);dialog.html({html:n.innerHTML,load:function(){var n=dom.find('div[widget-id="dialogQuestionEdit"]'),t=dom.find("a[widget-id=buttonAdd]",n);dom.bind(t,"click",function(t){var e=dom.element('\n          <li class="list-group-item d-flex pt-0 pb-0">\n            <input onfocus="QuestionnaireDesigner.instance.onCellFocus(this);" \n                   onkeydown="QuestionnaireDesigner.instance.onCellKeyPress(event);"\n                   name="values" style="border: none; height=100%; width: 100%" value="选项">\n            <input onfocus="QuestionnaireDesigner.instance.onCellFocus(this);" \n                   onkeydown="QuestionnaireDesigner.instance.onCellKeyPress(event);"\n                   name="scores" style="border: none; width: 50px" value="0">\n            <a class="btn text-danger line-height-32" onclick="this.parentElement.remove();">\n              <span class="material-icons">highlight_off</span>\n            </a>\n          </li>\n        ');dom.find("ul",n).appendChild(e)})},success:function(){var t=dom.find('div[widget-id="dialogQuestionEdit"]'),e=t.querySelectorAll("input[name=values]"),n=dom.formdata(t);n.values=[],n.scores=[],e.forEach(function(t,e){"values"===t.name&&n.values.push(t.value)}),(e=t.querySelectorAll("input[name=scores]")).forEach(function(t,e){"scores"===t.name&&n.scores.push(t.value)}),i.renderQuestion(i.widgetQuestionnaireCanvas,_objectSpread(_objectSpread({},n),{},{id:r})),i.dispatchEvent()}})},QuestionnaireDesigner.prototype.onCellFocus=function(t){t.setSelectionRange(0,t.value.length)},QuestionnaireDesigner.prototype.onCellKeyPress=function(t){for(var e=dom.ancestor(t.target,"ul").querySelectorAll("input"),n=-1,i=0;i<e.length;i++)if(e[i]===t.target){n=i;break}38==t.keyCode?0<=n-1&&e[n-1].focus():40==t.keyCode&&n+1<e.length&&e[n+1].focus()},QuestionnaireDesigner.prototype.getQuestions=function(){var i=[];return this.widgetQuestionnaireCanvas.querySelectorAll(".questionnaire-question").forEach(function(t,e){var n=JSON.parse(t.getAttribute("data-questionnaire-question-model"));i.push({questionId:t.getAttribute("data-questionnaire-question-id"),questionName:n.title,questionType:n.type,content:JSON.stringify(n),ordinalPosition:e})}),i},QuestionnaireDesigner.prototype.setQuestionIds=function(n){this.widgetQuestionnaireCanvas.querySelectorAll(".questionnaire-question").forEach(function(t,e){t.setAttribute("data-questionnaire-question-id",n[e])})},QuestionnaireDesigner.prototype.selectText=function(t){var e,n;window.getSelection&&document.createRange?""==(e=window.getSelection()).toString()&&window.setTimeout(function(){(n=document.createRange()).selectNodeContents(t),e.removeAllRanges(),e.addRange(n)},1):document.selection&&""==(e=document.selection.createRange()).text&&((n=document.body.createTextRange()).moveToElementText(t),n.select())},QuestionnaireDesigner.prototype.dispatchEvent=function(){var t=new CustomEvent("html-changed",{bubbles:!1,detail:{html:this.widgetQuestionnaireCanvas.innerHTML}});this.widgetQuestionnaireCanvas.dispatchEvent(t)},QuestionnaireDesigner.prototype.on=function(t,e){this.widgetQuestionnaireCanvas.addEventListener(t,e)},ReadonlyForm.prototype.fetch=function(t){var e,n=this;this.url?(e={},utils.clone(this.params,e),utils.clone(t||{},e),xhr.promise({url:this.url,params:e}).then(function(t){var e=t;n.convert&&(e=n.convert(t)),n.root(e)})):this.root(t)},ReadonlyForm.prototype.root=function(a){for(var o=this,s=(this.container.innerHTML="",a=a||{},this),l=dom.element('<div class="gx-row"></div>'),d=0;d<this.fields.length;d++)!function(){var e,n=o.fields[d],t=(n.emptyText=n.emptyText||"-",n.columnCount=n.columnCount||1,parseInt(12/Number(s.columnCount)),24/s.columnCount),i=0,r=0,t=(24==t?(i=6,r=18):12==t?(i=4,r=8):8==t?(i=3,r=5):6==t&&(i=2,r=4),dom.element('<div class="gx-24-'+o.formatGridCount(i)+'" style="line-height: 32px;"></div>')),i=dom.element('<strong class="gx-24-'+o.formatGridCount(r)+'" style="line-height: 32px;"></strong>');n.title&&(t.innerText=n.title+"：",e=null,e=void 0!==n.getValue?n.getValue.apply(null,a):null==a[n.name]?n.emptyText:a[n.name],n.display?(i=dom.element('<div class="gx-24-'+o.formatGridCount(r)+'" style="line-height: 32px;  height: 32px;"></div>'),n.display(a,i)):("-"!=(e=n.convert?n.convert(a[n.name]):e)?(n.convert?e=n.convert(a[n.name]):n.values&&0<n.values.length&&(n.values.forEach(function(t){!n.input||"radio"!=n.input&&"select"!=n.input||t.value!=a[n.name]||(e=t.text),n.input&&"checkbox"==n.input&&-1<a[n.name].indexOf(t.value)&&e.push(t.text)}),n.input)&&"checkbox"==n.input&&"object"==_typeof(e)&&(e=e.join(",")),n.unit&&(e+=n.unit)):e="-",i.innerHTML=e)),l.appendChild(t),l.appendChild(i)}();this.container.appendChild(l)},ReadonlyForm.prototype.reload=function(t){this.fetch(t)},ReadonlyForm.prototype.render=function(t,e){void 0!==t&&(this.container=dom.find(t)),this.fetch(e)},ReadonlyForm.prototype.formatGridCount=function(t){return t<10?"0"+t:""+t};